{"ast":null,"code":"import _objectSpread from\"c:/UMI/Frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{academicsService}from'../api/academicsService';import{api}from'../api/api';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{faCreditCard,faCheckCircle,faFilter,faExclamationTriangle,faFileAlt,faHistory,faMoneyBillWave}from'@fortawesome/free-solid-svg-icons';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SearchableStudentSelect=_ref=>{let{students,selectedStudent,onStudentSelect,disabled}=_ref;const[searchTerm,setSearchTerm]=useState('');const[isOpen,setIsOpen]=useState(false);const[filteredStudents,setFilteredStudents]=useState(students);useEffect(()=>{const filtered=students.filter(student=>{var _student$registration;return formatStudentName(student).toLowerCase().includes(searchTerm.toLowerCase())||((_student$registration=student.registration_number)===null||_student$registration===void 0?void 0:_student$registration.toLowerCase().includes(searchTerm.toLowerCase()));});setFilteredStudents(filtered);},[students,searchTerm]);const selectedStudentData=students.find(s=>s.id===selectedStudent);const formatStudentName=student=>{if(student.first_name&&student.last_name){return\"\".concat(student.first_name.trim(),\" \").concat(student.last_name.trim());}else if(student.name){return student.name.trim();}else{return'Unknown Student';}};const capitalizeFirstLetter=str=>{return str.charAt(0).toUpperCase()+str.slice(1).toLowerCase();};return/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:selectedStudentData?\"\".concat(capitalizeFirstLetter(formatStudentName(selectedStudentData)),\" (\").concat(selectedStudentData.registration_number,\")\"):searchTerm,onChange:e=>{setSearchTerm(e.target.value);if(!isOpen)setIsOpen(true);},onFocus:()=>setIsOpen(true),onBlur:()=>setTimeout(()=>setIsOpen(false),200),disabled:disabled,placeholder:disabled?'No students available':'Search students by name or registration...',className:\"shadow appearance-none border rounded w-full py-2 px-3 pr-10 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setIsOpen(!isOpen),disabled:disabled,className:\"absolute inset-y-0 right-0 flex items-center pr-3 disabled:cursor-not-allowed\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFilter,className:\"text-gray-400\"})})]}),isOpen&&!disabled&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none\",children:filteredStudents.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 text-gray-500\",children:\"No students found\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{onClick:()=>{onStudentSelect(null);setSearchTerm('');setIsOpen(false);},className:\"cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100\",children:/*#__PURE__*/_jsx(\"span\",{className:\"font-normal block truncate text-gray-500\",children:\"Clear selection\"})}),filteredStudents.map(student=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>{onStudentSelect(student.id);setSearchTerm('');setIsOpen(false);},className:\"cursor-pointer select-none relative py-2 pl-3 pr-9 \".concat(selectedStudent===student.id?'bg-indigo-100 text-indigo-900':'hover:bg-gray-100'),children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-normal block truncate \".concat(selectedStudent===student.id?'font-semibold':''),children:[capitalizeFirstLetter(formatStudentName(student)),\" (\",student.registration_number,\")\"]}),selectedStudent===student.id&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute inset-y-0 right-0 flex items-center pr-4\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,className:\"text-indigo-600\"})})]},student.id))]})})]});};const FeeManagement=()=>{var _departments$find2,_semesters$find4,_departments$find3,_semesters$find5,_departments$find4,_semesters$find6,_aggregatedPayments$t,_aggregatedPayments$p,_departments$find5,_semesters$find8,_semesters$find0,_students$find,_semesters$find1,_receiptData$fee,_receiptData$fee2,_receiptData$totalPai,_receiptData$balance;const[fees,setFees]=useState([]);const[students,setStudents]=useState([]);const[departments,setDepartments]=useState([]);const[semesters,setSemesters]=useState([]);const[filteredFees,setFilteredFees]=useState([]);const[selectedStudent,setSelectedStudent]=useState(null);const[selectedDepartment,setSelectedDepartment]=useState(null);const[selectedSemester,setSelectedSemester]=useState(null);const[statusFilter,setStatusFilter]=useState('All');const[filteredStudents,setFilteredStudents]=useState([]);const[isModalOpen,setIsModalOpen]=useState(false);const[selectedFee,setSelectedFee]=useState(null);const[paymentAmount,setPaymentAmount]=useState('');const[paymentMethod,setPaymentMethod]=useState('Cash');const[showPaymentHistoryModal,setShowPaymentHistoryModal]=useState(false);const[paymentHistory,setPaymentHistory]=useState([]);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState(null);const[isLoadingStudents,setIsLoadingStudents]=useState(false);const[studentError,setStudentError]=useState(null);const[showReceipt,setShowReceipt]=useState(false);const[lastPayment,setLastPayment]=useState(null);const[showAddFeeModal,setShowAddFeeModal]=useState(false);const[newFeeData,setNewFeeData]=useState({student_id:'',term:'',amount:'',due_date:''});const[showDepartmentFeeModal,setShowDepartmentFeeModal]=useState(false);const[departmentFeeData,setDepartmentFeeData]=useState({department_id:'',semester_id:'',amount:'',due_date:''});const[showStudentReceiptModal,setShowStudentReceiptModal]=useState(false);const[showReportModal,setShowReportModal]=useState(false);const[reportData,setReportData]=useState(null);const[showGenerateReceiptModal,setShowGenerateReceiptModal]=useState(false);const[receiptData,setReceiptData]=useState(null);const[showDepartmentReportModal,setShowDepartmentReportModal]=useState(false);const[studentReceiptData,setStudentReceiptData]=useState(null);const[departmentReportData,setDepartmentReportData]=useState(null);const[activeTab,setActiveTab]=useState('status');const[studentFeeStatuses,setStudentFeeStatuses]=useState([]);const[filteredStudentFeeStatuses,setFilteredStudentFeeStatuses]=useState([]);const[selectedStudentForHistory,setSelectedStudentForHistory]=useState(null);const[selectedStudentsForPayment,setSelectedStudentsForPayment]=useState([]);const[showBulkPaymentModal,setShowBulkPaymentModal]=useState(false);const[aggregatedPayments,setAggregatedPayments]=useState(null);const[isLoadingAggregated,setIsLoadingAggregated]=useState(false);const[studentPaymentHistory,setStudentPaymentHistory]=useState([]);const[isLoadingReport,setIsLoadingReport]=useState(false);useEffect(()=>{fetchDepartments();fetchStudents();},[]);useEffect(()=>{fetchSemesters();},[selectedDepartment]);// Fetch semesters when department changes\nuseEffect(()=>{if(selectedDepartment){fetchSemesters(selectedDepartment);setSelectedSemester(null);// Reset semester when department changes\n}else{fetchSemesters();// Fetch all semesters if no department selected\n}},[selectedDepartment]);useEffect(()=>{if(selectedDepartment&&selectedSemester){fetchStudentFeeStatuses();}else{setFees([]);setStudentFeeStatuses([]);setFilteredStudentFeeStatuses([]);}},[selectedDepartment,selectedSemester]);useEffect(()=>{filterFees();},[fees,statusFilter]);// Filter students based on selected department, semester, and fee status\nuseEffect(()=>{let filtered=students;if(selectedDepartment){filtered=filtered.filter(student=>student.department_id===selectedDepartment);}if(selectedSemester){filtered=filtered.filter(student=>student.semester_id===selectedSemester);}setFilteredStudents(filtered);},[students,selectedDepartment,selectedSemester]);// Filter student fee statuses based on status filter\nuseEffect(()=>{let filtered=studentFeeStatuses;if(statusFilter!=='All'){filtered=filtered.filter(student=>student.fee_info&&student.fee_info.status===statusFilter);}setFilteredStudentFeeStatuses(filtered);},[studentFeeStatuses,statusFilter]);// Fetch student details when selectedStudent changes\nuseEffect(()=>{if(selectedStudent){fetchStudent(selectedStudent).then(()=>{fetchStudents();// Refetch all students to include any newly added ones\n});}else{setSelectedDepartment(null);setSelectedSemester(null);}},[selectedStudent]);// Fetch aggregated payments when department and semester change\nuseEffect(()=>{if(selectedDepartment&&selectedSemester&&activeTab==='history'){fetchAggregatedPayments();}else{setAggregatedPayments(null);}},[selectedDepartment,selectedSemester,activeTab]);const fetchDepartments=async()=>{try{const response=await academicsService.getDepartments();console.log('Departments fetched:',response.data);setDepartments(response.data);}catch(err){console.error('Failed to fetch departments:',err);}};const fetchSemesters=async departmentId=>{try{if(departmentId){const response=await academicsService.getSemestersByDepartment(departmentId);setSemesters(response.data);}else{setSemesters([]);// Do not fetch all semesters if no department is selected\n}}catch(err){console.error('Failed to fetch semesters:',err);setSemesters([]);}};const fetchStudents=async()=>{setIsLoadingStudents(true);setStudentError(null);try{const response=await academicsService.getStudents();// Validate and clean student data\nconst validStudents=response.data.filter(student=>{if(!student.id){console.warn('Student missing id:',student);return false;}return true;}).map(student=>_objectSpread(_objectSpread({},student),{},{first_name:student.first_name||'',last_name:student.last_name||'',name:student.name||'',registration_number:student.registration_number||'N/A',department_id:student.department_id||null,semester_id:student.semester_id||null}));setStudents(validStudents);}catch(err){console.error('Failed to fetch students:',err);setStudentError(err.message||'Failed to load students. Please try again.');}finally{setIsLoadingStudents(false);}};const fetchStudentFees=async studentId=>{try{const response=await academicsService.getStudentFees(studentId);setFees(response.data.fees||[]);}catch(err){console.error('Failed to fetch student fees:',err);}};const fetchStudentFeeStatuses=async()=>{if(!selectedDepartment||!selectedSemester)return;try{const response=await api.get(\"academics/departments/\".concat(selectedDepartment,\"/semesters/\").concat(selectedSemester,\"/students/fees/\"));const students=response.data.students||[];setStudentFeeStatuses(students);setFilteredStudentFeeStatuses(students);// Initially show all\n// Extract fees from student fee statuses for the fee records table\nconst feeList=students.filter(s=>s.fee_info&&s.fee_info.fee_id).map(s=>s.fee_info);setFees(feeList);}catch(err){console.error('Failed to fetch student fee statuses:',err);setStudentFeeStatuses([]);setFilteredStudentFeeStatuses([]);setFees([]);}};const fetchAggregatedPayments=async()=>{if(!selectedDepartment||!selectedSemester)return;setIsLoadingAggregated(true);try{const response=await api.get(\"academics/departments/\".concat(selectedDepartment,\"/semesters/\").concat(selectedSemester,\"/payments/\"));setAggregatedPayments(response.data);}catch(err){console.error('Failed to fetch aggregated payments:',err);setAggregatedPayments(null);}finally{setIsLoadingAggregated(false);}};const fetchPaymentHistory=async feeId=>{try{const response=await api.get(\"academics/fees/\".concat(feeId,\"/payments/\"));setPaymentHistory(response.data||[]);setShowPaymentHistoryModal(true);}catch(err){console.error('Failed to fetch payment history:',err);setPaymentHistory([]);}};const handleCreateFee=async()=>{if(!newFeeData.student_id||!newFeeData.term||!newFeeData.amount||!newFeeData.due_date){setError('All fields are required');return;}setIsLoading(true);setError(null);try{const feeData={student_id:parseInt(newFeeData.student_id),term:newFeeData.term,amount:parseFloat(newFeeData.amount),due_date:newFeeData.due_date};await academicsService.createStudentFee(parseInt(newFeeData.student_id),feeData);// Refresh fees if we're viewing this student's fees\nif(selectedStudent===parseInt(newFeeData.student_id)){await fetchStudentFees(selectedStudent);}setShowAddFeeModal(false);setNewFeeData({student_id:'',term:'',amount:'',due_date:''});}catch(err){setError(err.message||'Failed to create fee record');}finally{setIsLoading(false);}};const handleCreateDepartmentFee=async()=>{if(!departmentFeeData.department_id||!departmentFeeData.semester_id||!departmentFeeData.due_date){setError('Department, semester, and due date are required');return;}setIsLoading(true);setError(null);try{const feeData={semester_id:parseInt(departmentFeeData.semester_id),due_date:departmentFeeData.due_date};// Use the api service which handles authentication automatically\nconst response=await api.post(\"academics/departments/\".concat(departmentFeeData.department_id,\"/create-fees/\"),feeData);// Refresh fees and student statuses if we're viewing this department's fees\nif(selectedDepartment===parseInt(departmentFeeData.department_id)){await fetchStudentFeeStatuses();}setShowDepartmentFeeModal(false);setDepartmentFeeData({department_id:'',semester_id:'',amount:'',due_date:''});alert(\"Successfully created \".concat(response.data.fees.length,\" fee records for the department with default amounts!\"));}catch(err){setError(err.message||'Failed to create department fee records');}finally{setIsLoading(false);}};const generateReport=async()=>{setIsLoadingReport(true);try{var _departments$find,_semesters$find;let reportFees=[];if(selectedStudent){// Generate report for specific student\nconst response=await academicsService.getStudentFees(selectedStudent);reportFees=response.data.fees||[];}else if(selectedDepartment&&selectedSemester){// Generate report for department/semester\nreportFees=fees;// Use fees already fetched from studentFeeStatuses\n}else{throw new Error('Please select a student or department and semester to generate report');}// Calculate aggregates\nconst totalFees=reportFees.length;const totalAmount=reportFees.reduce((sum,fee)=>sum+parseFloat(fee.amount),0);const totalPaid=reportFees.reduce((sum,fee)=>sum+parseFloat(fee.paid_amount),0);const totalBalance=reportFees.reduce((sum,fee)=>sum+fee.balance,0);// Status breakdown\nconst statusBreakdown={paid:reportFees.filter(fee=>fee.status==='Paid').length,unpaid:reportFees.filter(fee=>fee.status==='Unpaid').length,partial:reportFees.filter(fee=>fee.status==='Partial').length};// Find student if selected\nconst student=selectedStudent?students.find(s=>s.id===selectedStudent):null;const reportData={totalFees,totalAmount,totalPaid,totalBalance,statusBreakdown,generatedAt:new Date().toLocaleString(),department:selectedDepartment?(_departments$find=departments.find(d=>d.id===selectedDepartment))===null||_departments$find===void 0?void 0:_departments$find.name:'All Departments',semester:selectedSemester?(_semesters$find=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find===void 0?void 0:_semesters$find.name:'All Semesters',student:student,fees:reportFees};if(selectedStudent){// Show receipt for individual student\nconst student=students.find(s=>s.id===selectedStudent);if(student&&reportFees.length>0){setReceiptData({student,fee:reportFees[0],payments:[],generatedAt:reportData.generatedAt,totalPaid:reportData.totalPaid,balance:reportData.totalBalance,semester:reportData.semester});setShowGenerateReceiptModal(true);}}else{// Show report for department/semester\nsetReportData(reportData);setShowReportModal(true);}}catch(err){console.error('Failed to generate report:',err);setError(err.message||'Failed to generate report');}finally{setIsLoadingReport(false);}};const generateStudentReceipt=async studentId=>{try{var _semesters$find2;const student=students.find(s=>s.id===studentId);if(!student){setError('Student not found');return;}const response=await academicsService.getStudentFees(studentId);const fees=response.data.fees||[];if(fees.length===0){setError('No fee records found for this student');return;}// Get payment history for the latest fee\nconst latestFee=fees[0];// Assuming fees are ordered by most recent\nif(!latestFee||!latestFee.fee_id||typeof latestFee.fee_id!=='number'||latestFee.fee_id<=0){setError('No valid fee record found for this student');return;}const paymentResponse=await api.get(\"academics/fees/\".concat(latestFee.fee_id,\"/payments/\"));const payments=paymentResponse.data||[];const receiptData={student,fee:latestFee,payments,generatedAt:new Date().toLocaleString(),totalPaid:parseFloat(latestFee.paid_amount),balance:latestFee.balance,semester:((_semesters$find2=semesters.find(s=>s.id===latestFee.semester))===null||_semesters$find2===void 0?void 0:_semesters$find2.name)||'Unknown Semester'};setReceiptData(receiptData);setShowGenerateReceiptModal(true);}catch(err){console.error('Failed to generate receipt:',err);setError(err.message||'Failed to generate receipt');}};const fetchStudent=async studentId=>{try{const response=await academicsService.getStudent(studentId.toString());const student=response.data;setSelectedDepartment(student.department_id);setSelectedSemester(student.semester_id);}catch(err){console.error('Failed to fetch student:',err);}};const filterFees=()=>{let filtered=fees;// No need to filter by student since fees are already fetched for selected student\nif(statusFilter!=='All'){filtered=filtered.filter(fee=>fee.status===statusFilter);}setFilteredFees(filtered);};const handlePayment=async()=>{if(!selectedFee||!paymentAmount)return;const amount=parseFloat(paymentAmount);if(amount<=0){setError('Payment amount must be greater than 0');return;}const currentPaid=parseFloat(selectedFee.paid_amount);const totalAmount=parseFloat(selectedFee.amount);const newPaidAmount=currentPaid+amount;if(newPaidAmount>totalAmount){setError('Payment amount exceeds remaining balance');return;}setIsLoading(true);setError(null);try{var _semesters$find3;let newStatus;if(newPaidAmount>=totalAmount){newStatus='Paid';}else if(newPaidAmount>0){newStatus='Partial';}else{newStatus='Unpaid';}const updatedFee=_objectSpread(_objectSpread({},selectedFee),{},{paid_amount:newPaidAmount.toString(),status:newStatus,paid_on:new Date().toISOString().split('T')[0]});// Create payment record\nconst paymentData={amount:amount,payment_method:paymentMethod,notes:\"Payment for \".concat(((_semesters$find3=semesters.find(s=>s.id===selectedFee.semester))===null||_semesters$find3===void 0?void 0:_semesters$find3.name)||'Unknown Semester')};await api.post(\"academics/fees/\".concat(selectedFee.fee_id,\"/payments/\"),paymentData);// Refresh fees and student statuses\nif(selectedDepartment&&selectedSemester){await fetchStudentFeeStatuses();}// Set last payment for receipt\nsetLastPayment({amount:amount,date:new Date().toLocaleDateString()});setIsModalOpen(false);setShowReceipt(true);setSelectedFee(null);setPaymentAmount('');setPaymentMethod('Cash');}catch(err){setError(err.message||'Failed to process payment');}finally{setIsLoading(false);}};const openPaymentModal=fee=>{setSelectedFee(fee);setPaymentAmount('');setPaymentMethod('Cash');setIsModalOpen(true);};const openPaymentHistoryModal=feeId=>{if(feeId){fetchPaymentHistory(feeId);}else{console.error('Invalid fee ID for payment history');}};const formatStudentName=student=>{if(student.first_name&&student.last_name){return\"\".concat(student.first_name.trim(),\" \").concat(student.last_name.trim());}else if(student.name){return student.name.trim();}else{return'Unknown Student';}};const capitalizeFirstLetter=str=>{return str.charAt(0).toUpperCase()+str.slice(1).toLowerCase();};console.log('Rendering FeeManagement with departments:',departments);return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 md:p-6 max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-indigo-600 text-3xl mr-3\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl md:text-3xl font-bold text-gray-800\",children:\"Fee Management\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>generateReport(),className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"mr-2\"}),\"Generate Report\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowDepartmentFeeModal(true),className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),\"Add Department Fee\"]})]})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-r-lg flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-red-500 mr-3\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-red-700\",children:error})]}),studentError&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-r-lg flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-red-500 mr-3\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-red-700\",children:[\"Student Data Error: \",studentError]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 bg-white p-4 rounded-lg shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFilter,className:\"text-gray-600 mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-700\",children:\"Filters\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Select Student\"}),isLoadingStudents?/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center h-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-600\",children:\"Loading students...\"})]}):studentError?/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-2 bg-red-50 text-red-700\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"mr-2\"}),studentError]}):/*#__PURE__*/_jsx(SearchableStudentSelect,{students:filteredStudents,selectedStudent:selectedStudent,onStudentSelect:setSelectedStudent,disabled:filteredStudents.length===0})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Select Department\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedDepartment||'',onChange:e=>{setSelectedDepartment(e.target.value?parseInt(e.target.value):null);setSelectedStudent(null);// Reset student selection when department changes\n},disabled:!!selectedStudent,className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:selectedStudent?'Auto-selected from student':'Choose a department...'}),departments.map(dept=>/*#__PURE__*/_jsx(\"option\",{value:dept.id,children:dept.name},dept.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Select Semester\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedSemester||'',onChange:e=>{setSelectedSemester(e.target.value?parseInt(e.target.value):null);setSelectedStudent(null);// Reset student selection when semester changes\n},disabled:!selectedDepartment,className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:selectedStudent?'Auto-selected from student':selectedDepartment?semesters.length>0?'Choose a semester...':'No semesters available for this department':'Select department first'}),semesters.map(sem=>/*#__PURE__*/_jsxs(\"option\",{value:sem.id,children:[sem.name,\" (\",sem.semester_code,\")\"]},sem.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Filter by Status\"}),/*#__PURE__*/_jsxs(\"select\",{value:statusFilter,onChange:e=>setStatusFilter(e.target.value),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"All\",children:\"All\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Paid\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Unpaid\",children:\"Unpaid\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Partial\",children:\"Partial\"})]})]})]}),selectedDepartment&&selectedSemester&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Selected:\"}),\" \",(_departments$find2=departments.find(d=>d.id===selectedDepartment))===null||_departments$find2===void 0?void 0:_departments$find2.name,\" - \",(_semesters$find4=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find4===void 0?void 0:_semesters$find4.name,filteredStudents.length>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2\",children:[\"(\",filteredStudents.length,\" students found)\"]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm mb-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8 px-6\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('payment'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='payment'?'border-indigo-500 text-indigo-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),\"Fee Payment\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('status'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='status'?'border-indigo-500 text-indigo-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMoneyBillWave,className:\"mr-2\"}),\"Student Status\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('history'),className:\"py-4 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='history'?'border-indigo-500 text-indigo-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHistory,className:\"mr-2\"}),\"Payment History\"]})]})})}),isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600\"})}):!selectedDepartment||!selectedSemester?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-8 text-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFilter,className:\"text-gray-400 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Select Department and Semester\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Please select a department and semester above to view and manage student fees.\"})]}):activeTab==='payment'?/*#__PURE__*//* Fee Payment Tab */_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm p-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-green-600 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-4\",children:\"Fee Payment Processing\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-6\",children:\"Process fee payments for students. All fees are now standardized at $30,000 per semester.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{const unpaidStudents=studentFeeStatuses.filter(s=>s.fee_info&&(s.fee_info.status==='Unpaid'||s.fee_info.status==='Partial'));if(unpaidStudents.length===0){alert('No unpaid fees found for this department and semester.');return;}setSelectedStudentsForPayment(unpaidStudents.map(s=>s.id));setShowBulkPaymentModal(true);},className:\"p-6 border-2 border-dashed border-green-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMoneyBillWave,className:\"text-green-600 text-2xl mb-3\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Bulk Payment Processing\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Process payments for multiple students at once\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('status'),className:\"p-6 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-blue-600 text-2xl mb-3\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Individual Payments\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Process payments for individual students\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 bg-blue-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-blue-800 mb-2\",children:\"Fee Structure Information\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-700\",children:[\"All department-semester combinations now have a standardized fee of \",/*#__PURE__*/_jsx(\"strong\",{children:\"$30,000\"}),\". Fee records are automatically created for students based on their department and semester enrollment.\"]})]})]})}):activeTab==='status'?/*#__PURE__*//* Student Status Tab */_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm overflow-hidden\",children:!selectedDepartment||!selectedSemester?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFilter,className:\"text-gray-400 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Select Department and Semester\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Please select a department and semester above to view student fee status.\"})]}):filteredStudentFeeStatuses.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-yellow-400 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"No Students Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:statusFilter==='All'?'No students found for the selected department and semester combination.':\"No students found with \\\"\".concat(statusFilter,\"\\\" fee status for the selected department and semester.\")})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:[\"Student Fee Status (\",filteredStudentFeeStatuses.length,\" students)\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[(_departments$find3=departments.find(d=>d.id===selectedDepartment))===null||_departments$find3===void 0?void 0:_departments$find3.name,\" - \",(_semesters$find5=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find5===void 0?void 0:_semesters$find5.name]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{const unpaidStudents=filteredStudentFeeStatuses.filter(s=>s.fee_info&&(s.fee_info.status==='Unpaid'||s.fee_info.status==='Partial'));if(unpaidStudents.length===0){alert('No unpaid fees found for this department and semester.');return;}setSelectedStudentsForPayment(unpaidStudents.map(s=>s.id));setShowBulkPaymentModal(true);},className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faMoneyBillWave,className:\"mr-2\"}),\"Bulk Pay Selected\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{if(selectedStudentsForPayment.length===0){alert('Please select students first.');return;}setShowBulkPaymentModal(true);},disabled:selectedStudentsForPayment.length===0,className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),\"Pay Selected (\",selectedStudentsForPayment.length,\")\"]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"divide-y divide-gray-200\",children:filteredStudentFeeStatuses.map((studentData,index)=>{var _studentData$fee_info,_studentData$fee_info2,_studentData$first_na,_studentData$name,_studentData$fee_info3;return/*#__PURE__*/_jsx(\"div\",{className:\"p-6 hover:bg-gray-50 transition-colors duration-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center flex-1\",children:[studentData.fee_info&&studentData.fee_info.fee_id&&(studentData.fee_info.status==='Unpaid'||studentData.fee_info.status==='Partial')&&/*#__PURE__*/_jsx(\"div\",{className:\"mr-4\",children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedStudentsForPayment.includes(studentData.id),onChange:e=>{if(e.target.checked){setSelectedStudentsForPayment([...selectedStudentsForPayment,studentData.id]);}else{setSelectedStudentsForPayment(selectedStudentsForPayment.filter(id=>id!==studentData.id));}},className:\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold \".concat(((_studentData$fee_info=studentData.fee_info)===null||_studentData$fee_info===void 0?void 0:_studentData$fee_info.status)==='Paid'?'bg-green-500':((_studentData$fee_info2=studentData.fee_info)===null||_studentData$fee_info2===void 0?void 0:_studentData$fee_info2.status)==='Partial'?'bg-yellow-500':'bg-red-500'),children:((_studentData$first_na=studentData.first_name)===null||_studentData$first_na===void 0?void 0:_studentData$first_na.charAt(0))||((_studentData$name=studentData.name)===null||_studentData$name===void 0?void 0:_studentData$name.charAt(0))||'?'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4 flex-1\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-medium text-gray-900\",children:formatStudentName(studentData)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"Registration: \",studentData.registration_number||'N/A']})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-4\",children:studentData.fee_info&&studentData.fee_info.fee_id?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-900\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"$\",studentData.fee_info.amount]}),\" total\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[\"$\",((_studentData$fee_info3=studentData.fee_info.balance)===null||_studentData$fee_info3===void 0?void 0:_studentData$fee_info3.toFixed(2))||'0.00',\" remaining\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium \".concat(studentData.fee_info.status==='Paid'?'bg-green-100 text-green-800':studentData.fee_info.status==='Unpaid'?'bg-red-100 text-red-800':'bg-yellow-100 text-yellow-800'),children:[studentData.fee_info.status==='Paid'&&/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,className:\"mr-1\"}),studentData.fee_info.status]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[(studentData.fee_info.status==='Unpaid'||studentData.fee_info.status==='Partial')&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{const fee=studentData.fee_info;setSelectedFee(_objectSpread(_objectSpread({},fee),{},{student:studentData.id,semester:selectedSemester,department_id:selectedDepartment,semester_id:selectedSemester}));setIsModalOpen(true);},className:\"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-1\"}),\"Pay Now\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openPaymentHistoryModal(studentData.fee_info.fee_id),className:\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHistory,className:\"mr-2\"}),\"History\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>generateStudentReceipt(studentData.id),className:\"inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"mr-2\"}),\"Receipt\"]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800\",children:\"No Fee Record\"})})})]})},studentData.id||index);})})]})}):activeTab==='history'?/*#__PURE__*//* Payment History Tab */_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-4 border-b border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Payment History - All Students\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[(_departments$find4=departments.find(d=>d.id===selectedDepartment))===null||_departments$find4===void 0?void 0:_departments$find4.name,\" - \",(_semesters$find6=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find6===void 0?void 0:_semesters$find6.name]})]}),!selectedDepartment||!selectedSemester?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFilter,className:\"text-gray-400 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Select Department and Semester\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Please select a department and semester above to view payment history.\"})]}):filteredStudentFeeStatuses.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-yellow-400 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"No Students Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:statusFilter==='All'?'No students found for the selected department and semester combination.':\"No students found with \\\"\".concat(statusFilter,\"\\\" fee status for the selected department and semester.\")})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[isLoadingAggregated?/*#__PURE__*/_jsxs(\"div\",{className:\"p-8 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Loading aggregated payment history...\"})]}):aggregatedPayments?/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 bg-blue-50 border-b border-blue-200\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-blue-800 mb-3\",children:\"Aggregated Payment Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-3 rounded-lg shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:aggregatedPayments.total_payments}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-blue-800\",children:\"Total Payments\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-3 rounded-lg shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-green-600\",children:[\"$\",((_aggregatedPayments$t=aggregatedPayments.total_amount)===null||_aggregatedPayments$t===void 0?void 0:_aggregatedPayments$t.toFixed(2))||'0.00']}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-green-800\",children:\"Total Collected\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-3 rounded-lg shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-indigo-600\",children:((_aggregatedPayments$p=aggregatedPayments.payments)===null||_aggregatedPayments$p===void 0?void 0:_aggregatedPayments$p.length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-indigo-800\",children:\"Payment Records\"})]})]}),aggregatedPayments.payments&&aggregatedPayments.payments.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto mb-4\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-blue-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\",children:\"Student\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\",children:\"Method\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:[aggregatedPayments.payments.slice(0,10).map((payment,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-900\",children:payment.student_name}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm font-medium text-green-600\",children:[\"$\",payment.amount]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-900\",children:new Date(payment.payment_date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-900\",children:payment.payment_method||'N/A'})]},payment.payment_id||index)),aggregatedPayments.payments.length>10&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{colSpan:4,className:\"px-4 py-3 text-center text-sm text-gray-500\",children:[\"Showing first 10 of \",aggregatedPayments.payments.length,\" payments.\"]})})]})]})})]}):null,/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Student\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Semester\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Due Date\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:filteredStudentFeeStatuses.map((studentData,index)=>{var _semesters$find7,_studentData$fee_info4,_studentData$fee_info5,_studentData$fee_info6,_studentData$fee_info7,_studentData$fee_info8,_studentData$fee_info9,_studentData$fee_info0,_studentData$fee_info1;return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:formatStudentName(studentData)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:((_semesters$find7=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find7===void 0?void 0:_semesters$find7.name)||'Unknown Semester'}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",((_studentData$fee_info4=studentData.fee_info)===null||_studentData$fee_info4===void 0?void 0:_studentData$fee_info4.amount)||'0.00']}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",((_studentData$fee_info5=studentData.fee_info)===null||_studentData$fee_info5===void 0?void 0:_studentData$fee_info5.paid_amount)||'0.00']}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",((_studentData$fee_info6=studentData.fee_info)===null||_studentData$fee_info6===void 0?void 0:(_studentData$fee_info7=_studentData$fee_info6.balance)===null||_studentData$fee_info7===void 0?void 0:_studentData$fee_info7.toFixed(2))||'0.00']}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(((_studentData$fee_info8=studentData.fee_info)===null||_studentData$fee_info8===void 0?void 0:_studentData$fee_info8.status)==='Paid'?'bg-green-100 text-green-800':((_studentData$fee_info9=studentData.fee_info)===null||_studentData$fee_info9===void 0?void 0:_studentData$fee_info9.status)==='Unpaid'?'bg-red-100 text-red-800':'bg-yellow-100 text-yellow-800'),children:((_studentData$fee_info0=studentData.fee_info)===null||_studentData$fee_info0===void 0?void 0:_studentData$fee_info0.status)||'No Fee Record'})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:((_studentData$fee_info1=studentData.fee_info)===null||_studentData$fee_info1===void 0?void 0:_studentData$fee_info1.due_date)||'N/A'})]},studentData.id||index);})})]})})]})]}):/*#__PURE__*//* History Tab */_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-4 border-b border-gray-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:[\"Fee Records (\",filteredFees.length,\" records)\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[(_departments$find5=departments.find(d=>d.id===selectedDepartment))===null||_departments$find5===void 0?void 0:_departments$find5.name,\" - \",(_semesters$find8=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find8===void 0?void 0:_semesters$find8.name]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Student\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Semester\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Paid Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Due Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Last Payment\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Actions\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Receipt\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:filteredFees.map(fee=>{var _semesters$find9;const student=students.find(s=>s.id===fee.student);return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:student?formatStudentName(student):'Unknown Student'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:((_semesters$find9=semesters.find(s=>s.id===fee.semester))===null||_semesters$find9===void 0?void 0:_semesters$find9.name)||'Unknown Semester'}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",fee.amount]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",fee.paid_amount]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",fee.balance.toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(fee.status==='Paid'?'bg-green-100 text-green-800':fee.status==='Unpaid'?'bg-red-100 text-red-800':'bg-yellow-100 text-yellow-800'),children:[fee.status==='Paid'&&/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,className:\"mr-1\"}),fee.status]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:fee.due_date}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:fee.paid_on?new Date(fee.paid_on).toLocaleDateString():'No payments'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openPaymentHistoryModal(fee.fee_id),className:\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHistory,className:\"mr-2\"}),\"View History\"]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>generateStudentReceipt(fee.student),className:\"inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"mr-2\"}),\"Receipt\"]})})]},fee.fee_id);})})]})})]}),isModalOpen&&selectedFee&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-indigo-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Make Payment\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"Fee for \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:((_semesters$find0=semesters.find(s=>s.id===selectedFee.semester))===null||_semesters$find0===void 0?void 0:_semesters$find0.name)||'Unknown Semester'})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"Total Amount: \",/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[\"$\",selectedFee.amount]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"Balance: \",/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[\"$\",selectedFee.balance.toFixed(2)]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Payment Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:paymentAmount,onChange:e=>setPaymentAmount(e.target.value),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500\",placeholder:\"Enter amount\",min:\"0.01\",step:\"0.01\",max:selectedFee?(parseFloat(selectedFee.amount)-parseFloat(selectedFee.paid_amount)).toFixed(2):undefined}),selectedFee&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Maximum: $\",(parseFloat(selectedFee.amount)-parseFloat(selectedFee.paid_amount)).toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"select\",{value:paymentMethod,onChange:e=>setPaymentMethod(e.target.value),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Online\",children:\"Online\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Cheque\",children:\"Cheque\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsModalOpen(false),className:\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handlePayment,disabled:isLoading||!paymentAmount,className:\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 transition-colors duration-200\",children:[isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}):/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),isLoading?'Processing...':'Pay']})]})]})})}),showReceipt&&selectedStudent&&lastPayment&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Payment Receipt\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowReceipt(false),className:\"text-gray-500 hover:text-gray-700\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,size:\"lg\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-b border-gray-200 py-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800\",children:\"University Fee Payment\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"Receipt #\",Date.now()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Student:\"}),/*#__PURE__*/_jsx(\"span\",{children:students.find(s=>s.id===selectedStudent)?formatStudentName(students.find(s=>s.id===selectedStudent)):'Unknown'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Registration:\"}),/*#__PURE__*/_jsx(\"span\",{children:((_students$find=students.find(s=>s.id===selectedStudent))===null||_students$find===void 0?void 0:_students$find.registration_number)||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Semester:\"}),/*#__PURE__*/_jsx(\"span\",{children:((_semesters$find1=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find1===void 0?void 0:_semesters$find1.name)||'Unknown'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Payment Date:\"}),/*#__PURE__*/_jsx(\"span\",{children:lastPayment.date})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Amount Paid:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold text-green-600\",children:[\"$\",lastPayment.amount.toFixed(2)]})]}),(()=>{const studentData=studentFeeStatuses.find(s=>s.id===selectedStudent);if(studentData&&studentData.fee_info&&studentData.fee_info.payments&&studentData.fee_info.payments.length>0){const firstPayment=studentData.fee_info.payments[0];return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"First Payment:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-600\",children:[\"$\",firstPayment.amount,\" on \",new Date(firstPayment.payment_date).toLocaleDateString()]})]});}return null;})()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-4\",children:\"Thank you for your payment. This receipt serves as proof of payment.\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.print(),className:\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),\"Print Receipt\"]})]})]})})}),showAddFeeModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-green-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Add New Fee Record\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Select Student\"}),/*#__PURE__*/_jsxs(\"select\",{value:newFeeData.student_id,onChange:e=>setNewFeeData(_objectSpread(_objectSpread({},newFeeData),{},{student_id:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a student...\"}),students.map(student=>/*#__PURE__*/_jsxs(\"option\",{value:student.id,children:[capitalizeFirstLetter(formatStudentName(student)),\" (\",student.registration_number,\")\"]},student.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Term\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newFeeData.term,onChange:e=>setNewFeeData(_objectSpread(_objectSpread({},newFeeData),{},{term:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\",placeholder:\"e.g., Fall-2024, Semester-1\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:newFeeData.amount,onChange:e=>setNewFeeData(_objectSpread(_objectSpread({},newFeeData),{},{amount:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\",placeholder:\"Enter amount\",min:\"0.01\",step:\"0.01\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Due Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:newFeeData.due_date,onChange:e=>setNewFeeData(_objectSpread(_objectSpread({},newFeeData),{},{due_date:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowAddFeeModal(false);setNewFeeData({student_id:'',term:'',amount:'',due_date:''});},className:\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleCreateFee,disabled:isLoading,className:\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-colors duration-200\",children:[isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}):/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),isLoading?'Creating...':'Create Fee']})]})]})})}),showDepartmentFeeModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-purple-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Add Department Fee\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-blue-50 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800\",children:[\"This will create fee records for ALL students in the selected department and semester with default amounts:\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Even semesters: $25,000\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 Odd semesters: $30,000\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Select Department\"}),/*#__PURE__*/_jsxs(\"select\",{value:departmentFeeData.department_id,onChange:e=>setDepartmentFeeData(_objectSpread(_objectSpread({},departmentFeeData),{},{department_id:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a department...\"}),departments.map(department=>/*#__PURE__*/_jsxs(\"option\",{value:department.id,children:[department.name,\" (\",department.code,\")\"]},department.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Semester\"}),/*#__PURE__*/_jsxs(\"select\",{value:departmentFeeData.semester_id,onChange:e=>setDepartmentFeeData(_objectSpread(_objectSpread({},departmentFeeData),{},{semester_id:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a semester...\"}),semesters.map(semester=>/*#__PURE__*/_jsxs(\"option\",{value:semester.id,children:[semester.name,\" (\",semester.semester_code,\") - Default: $\",parseInt(semester.name.split(' ')[1])%2===0?'25,000':'30,000']},semester.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Due Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:departmentFeeData.due_date,onChange:e=>setDepartmentFeeData(_objectSpread(_objectSpread({},departmentFeeData),{},{due_date:e.target.value})),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowDepartmentFeeModal(false);setDepartmentFeeData({department_id:'',semester_id:'',amount:'',due_date:''});},className:\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-200\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleCreateDepartmentFee,disabled:isLoading,className:\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 transition-colors duration-200\",children:[isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}):/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),isLoading?'Creating...':'Create Department Fees']})]})]})})}),showReportModal&&reportData&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"text-blue-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Fee Report\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.print(),className:\"inline-flex items-center px-3 py-1 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"mr-2\"}),\"Print\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowReportModal(false),className:\"text-gray-500 hover:text-gray-700\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,size:\"lg\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:reportData.totalFees}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-blue-800\",children:\"Total Fees\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-green-600\",children:[\"$\",reportData.totalAmount.toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-green-800\",children:\"Total Amount\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-yellow-600\",children:[\"$\",reportData.totalPaid.toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-yellow-800\",children:\"Total Paid\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 p-3 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-red-600\",children:[\"$\",reportData.totalBalance.toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-red-800\",children:\"Total Balance\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-semibold text-green-600\",children:reportData.statusBreakdown.paid}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Paid\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-semibold text-red-600\",children:reportData.statusBreakdown.unpaid}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Unpaid\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-semibold text-yellow-600\",children:reportData.statusBreakdown.partial}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Partial\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 mb-4\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Report Generated:\"}),\" \",reportData.generatedAt]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Department:\"}),\" \",reportData.department]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Semester:\"}),\" \",reportData.semester]}),reportData.student&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Student:\"}),\" \",capitalizeFirstLetter(formatStudentName(reportData.student)),\" (\",reportData.student.registration_number,\")\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Student\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Semester\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Balance\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Due Date\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:reportData.fees.map(fee=>{var _semesters$find10;const student=students.find(s=>s.id===fee.student);return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:student?capitalizeFirstLetter(formatStudentName(student)):'Unknown'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:((_semesters$find10=semesters.find(s=>s.id===fee.semester))===null||_semesters$find10===void 0?void 0:_semesters$find10.name)||'Unknown Semester'}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",fee.amount]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",fee.paid_amount]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:[\"$\",fee.balance.toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(fee.status==='Paid'?'bg-green-100 text-green-800':fee.status==='Unpaid'?'bg-red-100 text-red-800':'bg-yellow-100 text-yellow-800'),children:fee.status})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:fee.due_date})]},fee.fee_id);})})]})})]})})}),showPaymentHistoryModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHistory,className:\"text-blue-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Payment History\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowPaymentHistoryModal(false),className:\"text-gray-500 hover:text-gray-700\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,size:\"lg\"})})]}),paymentHistory.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHistory,className:\"text-gray-400 text-4xl mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"No payment history found.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Method\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Notes\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:paymentHistory.map((payment,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:new Date(payment.payment_date).toLocaleDateString()}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold text-green-600\",children:[\"$\",payment.amount]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(payment.payment_method==='Cash'?'bg-green-100 text-green-800':payment.payment_method==='Online'?'bg-blue-100 text-blue-800':'bg-purple-100 text-purple-800'),children:payment.payment_method})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-4 text-sm text-gray-900\",children:payment.notes||'N/A'})]},payment.payment_id||index))})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowPaymentHistoryModal(false),className:\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\",children:\"Close\"})})]})})}),showBulkPaymentModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"text-green-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Bulk Payment Processing\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowBulkPaymentModal(false),className:\"text-gray-500 hover:text-gray-700\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,size:\"lg\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-4\",children:[\"Selected Students (\",selectedStudentsForPayment.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-4 max-h-60 overflow-y-auto\",children:selectedStudentsForPayment.map(studentId=>{var _studentData$fee_info10,_studentData$fee_info11;const studentData=studentFeeStatuses.find(s=>s.id===studentId);return studentData?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between py-2 border-b border-gray-200 last:border-b-0\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:formatStudentName(studentData)}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-600 ml-2\",children:[\"($\",((_studentData$fee_info10=studentData.fee_info)===null||_studentData$fee_info10===void 0?void 0:(_studentData$fee_info11=_studentData$fee_info10.balance)===null||_studentData$fee_info11===void 0?void 0:_studentData$fee_info11.toFixed(2))||'0.00',\" remaining)\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setSelectedStudentsForPayment(selectedStudentsForPayment.filter(id=>id!==studentId));},className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle})})]},studentId):null;})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"select\",{value:paymentMethod,onChange:e=>setPaymentMethod(e.target.value),className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Online\",children:\"Online\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Cheque\",children:\"Cheque\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 p-4 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" This will process full payment for all selected students. Each student will receive a separate receipt.\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowBulkPaymentModal(false),className:\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{setIsLoading(true);try{for(const studentId of selectedStudentsForPayment){const studentData=studentFeeStatuses.find(s=>s.id===studentId);if(studentData&&studentData.fee_info){var _semesters$find11;const paymentData={amount:studentData.fee_info.balance||0,payment_method:paymentMethod,notes:\"Bulk payment for \".concat(((_semesters$find11=semesters.find(s=>s.id===selectedSemester))===null||_semesters$find11===void 0?void 0:_semesters$find11.name)||'Unknown Semester')};await api.post(\"academics/fees/\".concat(studentData.fee_info.fee_id,\"/payments/\"),paymentData);}}// Refresh data\nawait fetchStudentFeeStatuses();setSelectedStudentsForPayment([]);setShowBulkPaymentModal(false);alert(\"Successfully processed payments for \".concat(selectedStudentsForPayment.length,\" students!\"));}catch(err){setError(err.message||'Failed to process bulk payments');}finally{setIsLoading(false);}},disabled:isLoading||selectedStudentsForPayment.length===0,className:\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-colors duration-200\",children:[isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}):/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard,className:\"mr-2\"}),isLoading?'Processing...':\"Process Payments (\".concat(selectedStudentsForPayment.length,\")\")]})]})]})})}),showGenerateReceiptModal&&receiptData&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"text-blue-600 text-xl mr-2\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold text-gray-800\",children:\"Fee Receipt\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.print(),className:\"inline-flex items-center px-3 py-1 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faFileAlt,className:\"mr-2\"}),\"Print\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowGenerateReceiptModal(false),className:\"text-gray-500 hover:text-gray-700\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle,size:\"lg\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-b border-gray-200 py-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800\",children:\"University Fee Payment\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"Receipt #\",((_receiptData$fee=receiptData.fee)===null||_receiptData$fee===void 0?void 0:_receiptData$fee.fee_id)||Date.now()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Student:\"}),/*#__PURE__*/_jsx(\"span\",{children:formatStudentName(receiptData.student)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Registration:\"}),/*#__PURE__*/_jsx(\"span\",{children:receiptData.student.registration_number||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Semester:\"}),/*#__PURE__*/_jsx(\"span\",{children:receiptData.semester})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Fee Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",((_receiptData$fee2=receiptData.fee)===null||_receiptData$fee2===void 0?void 0:_receiptData$fee2.amount)||'0.00']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Total Paid:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold text-green-600\",children:[\"$\",((_receiptData$totalPai=receiptData.totalPaid)===null||_receiptData$totalPai===void 0?void 0:_receiptData$totalPai.toFixed(2))||'0.00']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Balance:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",((_receiptData$balance=receiptData.balance)===null||_receiptData$balance===void 0?void 0:_receiptData$balance.toFixed(2))||'0.00']})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-md font-medium text-gray-800 mb-2\",children:\"Payment History\"}),receiptData.payments&&receiptData.payments.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Submission Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Method\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Notes\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:receiptData.payments.map((payment,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900\",children:new Date(payment.payment_date).toLocaleDateString()}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm font-medium text-green-600\",children:[\"$\",payment.amount]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 whitespace-nowrap text-sm text-gray-900\",children:payment.payment_method}),/*#__PURE__*/_jsx(\"td\",{className:\"px-3 py-2 text-sm text-gray-900\",children:payment.notes||'N/A'})]},payment.payment_id||index))})]})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"No payment history available.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-4\",children:\"Thank you for your payment. This receipt serves as proof of payment.\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[\"Generated on \",receiptData.generatedAt]})]})]})})})]});};export default FeeManagement;","map":{"version":3,"names":["React","useState","useEffect","academicsService","api","FontAwesomeIcon","faCreditCard","faCheckCircle","faFilter","faExclamationTriangle","faFileAlt","faHistory","faMoneyBillWave","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SearchableStudentSelect","_ref","students","selectedStudent","onStudentSelect","disabled","searchTerm","setSearchTerm","isOpen","setIsOpen","filteredStudents","setFilteredStudents","filtered","filter","student","_student$registration","formatStudentName","toLowerCase","includes","registration_number","selectedStudentData","find","s","id","first_name","last_name","concat","trim","name","capitalizeFirstLetter","str","charAt","toUpperCase","slice","className","children","type","value","onChange","e","target","onFocus","onBlur","setTimeout","placeholder","onClick","icon","length","map","FeeManagement","_departments$find2","_semesters$find4","_departments$find3","_semesters$find5","_departments$find4","_semesters$find6","_aggregatedPayments$t","_aggregatedPayments$p","_departments$find5","_semesters$find8","_semesters$find0","_students$find","_semesters$find1","_receiptData$fee","_receiptData$fee2","_receiptData$totalPai","_receiptData$balance","fees","setFees","setStudents","departments","setDepartments","semesters","setSemesters","filteredFees","setFilteredFees","setSelectedStudent","selectedDepartment","setSelectedDepartment","selectedSemester","setSelectedSemester","statusFilter","setStatusFilter","isModalOpen","setIsModalOpen","selectedFee","setSelectedFee","paymentAmount","setPaymentAmount","paymentMethod","setPaymentMethod","showPaymentHistoryModal","setShowPaymentHistoryModal","paymentHistory","setPaymentHistory","isLoading","setIsLoading","error","setError","isLoadingStudents","setIsLoadingStudents","studentError","setStudentError","showReceipt","setShowReceipt","lastPayment","setLastPayment","showAddFeeModal","setShowAddFeeModal","newFeeData","setNewFeeData","student_id","term","amount","due_date","showDepartmentFeeModal","setShowDepartmentFeeModal","departmentFeeData","setDepartmentFeeData","department_id","semester_id","showStudentReceiptModal","setShowStudentReceiptModal","showReportModal","setShowReportModal","reportData","setReportData","showGenerateReceiptModal","setShowGenerateReceiptModal","receiptData","setReceiptData","showDepartmentReportModal","setShowDepartmentReportModal","studentReceiptData","setStudentReceiptData","departmentReportData","setDepartmentReportData","activeTab","setActiveTab","studentFeeStatuses","setStudentFeeStatuses","filteredStudentFeeStatuses","setFilteredStudentFeeStatuses","selectedStudentForHistory","setSelectedStudentForHistory","selectedStudentsForPayment","setSelectedStudentsForPayment","showBulkPaymentModal","setShowBulkPaymentModal","aggregatedPayments","setAggregatedPayments","isLoadingAggregated","setIsLoadingAggregated","studentPaymentHistory","setStudentPaymentHistory","isLoadingReport","setIsLoadingReport","fetchDepartments","fetchStudents","fetchSemesters","fetchStudentFeeStatuses","filterFees","fee_info","status","fetchStudent","then","fetchAggregatedPayments","response","getDepartments","console","log","data","err","departmentId","getSemestersByDepartment","getStudents","validStudents","warn","_objectSpread","message","fetchStudentFees","studentId","getStudentFees","get","feeList","fee_id","fetchPaymentHistory","feeId","handleCreateFee","feeData","parseInt","parseFloat","createStudentFee","handleCreateDepartmentFee","post","alert","generateReport","_departments$find","_semesters$find","reportFees","Error","totalFees","totalAmount","reduce","sum","fee","totalPaid","paid_amount","totalBalance","balance","statusBreakdown","paid","unpaid","partial","generatedAt","Date","toLocaleString","department","d","semester","payments","generateStudentReceipt","_semesters$find2","latestFee","paymentResponse","getStudent","toString","handlePayment","currentPaid","newPaidAmount","_semesters$find3","newStatus","updatedFee","paid_on","toISOString","split","paymentData","payment_method","notes","date","toLocaleDateString","openPaymentModal","openPaymentHistoryModal","dept","sem","semester_code","unpaidStudents","studentData","index","_studentData$fee_info","_studentData$fee_info2","_studentData$first_na","_studentData$name","_studentData$fee_info3","checked","toFixed","total_payments","total_amount","payment","student_name","payment_date","payment_id","colSpan","_semesters$find7","_studentData$fee_info4","_studentData$fee_info5","_studentData$fee_info6","_studentData$fee_info7","_studentData$fee_info8","_studentData$fee_info9","_studentData$fee_info0","_studentData$fee_info1","_semesters$find9","min","step","max","undefined","size","now","firstPayment","window","print","code","_semesters$find10","_studentData$fee_info10","_studentData$fee_info11","_semesters$find11"],"sources":["c:/UMI/Frontend/src/components/FeeManagement.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { academicsService } from '../api/academicsService';\nimport { api } from '../api/api';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCreditCard, faCheckCircle, faFilter, faExclamationTriangle, faFileAlt, faHistory, faMoneyBillWave } from '@fortawesome/free-solid-svg-icons';\n\ninterface Fee {\n  fee_id: number;\n  student: number;\n  semester: number;\n  amount: string;\n  paid_amount: string;\n  status: 'Paid' | 'Unpaid' | 'Partial';\n  due_date: string;\n  paid_on?: string;\n  balance: number;\n  department_id: number;\n  semester_id: number;\n}\n\ninterface Student {\n  id: number;\n  first_name?: string;\n  last_name?: string;\n  name?: string;\n  registration_number?: string;\n  department_id?: number;\n  semester_id?: number;\n}\n\ninterface Department {\n  id: number;\n  name: string;\n  code: string;\n}\n\ninterface Semester {\n  id: number;\n  name: string;\n  semester_code: string;\n}\n\ninterface SearchableStudentSelectProps {\n  students: Student[];\n  selectedStudent: number | null;\n  onStudentSelect: (studentId: number | null) => void;\n  disabled: boolean;\n}\n\nconst SearchableStudentSelect: React.FC<SearchableStudentSelectProps> = ({\n  students,\n  selectedStudent,\n  onStudentSelect,\n  disabled\n}) => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [filteredStudents, setFilteredStudents] = useState<Student[]>(students);\n\n  useEffect(() => {\n    const filtered = students.filter(student =>\n      formatStudentName(student).toLowerCase().includes(searchTerm.toLowerCase()) ||\n      student.registration_number?.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n    setFilteredStudents(filtered);\n  }, [students, searchTerm]);\n\n  const selectedStudentData = students.find(s => s.id === selectedStudent);\n\n  const formatStudentName = (student: Student) => {\n    if (student.first_name && student.last_name) {\n      return `${student.first_name.trim()} ${student.last_name.trim()}`;\n    } else if (student.name) {\n      return student.name.trim();\n    } else {\n      return 'Unknown Student';\n    }\n  };\n\n  const capitalizeFirstLetter = (str: string) => {\n    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n  };\n\n  return (\n    <div className=\"relative\">\n      <div className=\"relative\">\n        <input\n          type=\"text\"\n          value={selectedStudentData ? `${capitalizeFirstLetter(formatStudentName(selectedStudentData))} (${selectedStudentData.registration_number})` : searchTerm}\n          onChange={(e) => {\n            setSearchTerm(e.target.value);\n            if (!isOpen) setIsOpen(true);\n          }}\n          onFocus={() => setIsOpen(true)}\n          onBlur={() => setTimeout(() => setIsOpen(false), 200)}\n          disabled={disabled}\n          placeholder={disabled ? 'No students available' : 'Search students by name or registration...'}\n          className=\"shadow appearance-none border rounded w-full py-2 px-3 pr-10 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n        />\n        <button\n          type=\"button\"\n          onClick={() => setIsOpen(!isOpen)}\n          disabled={disabled}\n          className=\"absolute inset-y-0 right-0 flex items-center pr-3 disabled:cursor-not-allowed\"\n        >\n          <FontAwesomeIcon icon={faFilter} className=\"text-gray-400\" />\n        </button>\n      </div>\n\n      {isOpen && !disabled && (\n        <div className=\"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none\">\n          {filteredStudents.length === 0 ? (\n            <div className=\"px-3 py-2 text-gray-500\">No students found</div>\n          ) : (\n            <>\n              <div\n                onClick={() => {\n                  onStudentSelect(null);\n                  setSearchTerm('');\n                  setIsOpen(false);\n                }}\n                className=\"cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100\"\n              >\n                <span className=\"font-normal block truncate text-gray-500\">Clear selection</span>\n              </div>\n              {filteredStudents.map((student) => (\n                <div\n                  key={student.id}\n                  onClick={() => {\n                    onStudentSelect(student.id);\n                    setSearchTerm('');\n                    setIsOpen(false);\n                  }}\n                  className={`cursor-pointer select-none relative py-2 pl-3 pr-9 ${\n                    selectedStudent === student.id ? 'bg-indigo-100 text-indigo-900' : 'hover:bg-gray-100'\n                  }`}\n                >\n                  <span className={`font-normal block truncate ${selectedStudent === student.id ? 'font-semibold' : ''}`}>\n                    {capitalizeFirstLetter(formatStudentName(student))} ({student.registration_number})\n                  </span>\n                  {selectedStudent === student.id && (\n                    <span className=\"absolute inset-y-0 right-0 flex items-center pr-4\">\n                      <FontAwesomeIcon icon={faCheckCircle} className=\"text-indigo-600\" />\n                    </span>\n                  )}\n                </div>\n              ))}\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst FeeManagement: React.FC = () => {\n  const [fees, setFees] = useState<Fee[]>([]);\n  const [students, setStudents] = useState<Student[]>([]);\n  const [departments, setDepartments] = useState<Department[]>([]);\n  const [semesters, setSemesters] = useState<Semester[]>([]);\n  const [filteredFees, setFilteredFees] = useState<Fee[]>([]);\n  const [selectedStudent, setSelectedStudent] = useState<number | null>(null);\n  const [selectedDepartment, setSelectedDepartment] = useState<number | null>(null);\n  const [selectedSemester, setSelectedSemester] = useState<number | null>(null);\n  const [statusFilter, setStatusFilter] = useState<string>('All');\n  const [filteredStudents, setFilteredStudents] = useState<Student[]>([]);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [selectedFee, setSelectedFee] = useState<Fee | null>(null);\n  const [paymentAmount, setPaymentAmount] = useState<string>('');\n  const [paymentMethod, setPaymentMethod] = useState<string>('Cash');\n  const [showPaymentHistoryModal, setShowPaymentHistoryModal] = useState(false);\n  const [paymentHistory, setPaymentHistory] = useState<any[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [isLoadingStudents, setIsLoadingStudents] = useState(false);\n  const [studentError, setStudentError] = useState<string | null>(null);\n  const [showReceipt, setShowReceipt] = useState(false);\n  const [lastPayment, setLastPayment] = useState<{amount: number, date: string} | null>(null);\n  const [showAddFeeModal, setShowAddFeeModal] = useState(false);\n  const [newFeeData, setNewFeeData] = useState({\n    student_id: '',\n    term: '',\n    amount: '',\n    due_date: ''\n  });\n  const [showDepartmentFeeModal, setShowDepartmentFeeModal] = useState(false);\n  const [departmentFeeData, setDepartmentFeeData] = useState({\n    department_id: '',\n    semester_id: '',\n    amount: '',\n    due_date: ''\n  });\n  const [showStudentReceiptModal, setShowStudentReceiptModal] = useState(false);\n  const [showReportModal, setShowReportModal] = useState(false);\n  const [reportData, setReportData] = useState<any>(null);\n  const [showGenerateReceiptModal, setShowGenerateReceiptModal] = useState(false);\n  const [receiptData, setReceiptData] = useState<any>(null);\n  const [showDepartmentReportModal, setShowDepartmentReportModal] = useState(false);\n  const [studentReceiptData, setStudentReceiptData] = useState<any>(null);\n  const [departmentReportData, setDepartmentReportData] = useState<any>(null);\n  const [activeTab, setActiveTab] = useState<'payment' | 'status' | 'history'>('status');\n  const [studentFeeStatuses, setStudentFeeStatuses] = useState<any[]>([]);\n  const [filteredStudentFeeStatuses, setFilteredStudentFeeStatuses] = useState<any[]>([]);\n  const [selectedStudentForHistory, setSelectedStudentForHistory] = useState<number | null>(null);\n  const [selectedStudentsForPayment, setSelectedStudentsForPayment] = useState<number[]>([]);\n  const [showBulkPaymentModal, setShowBulkPaymentModal] = useState(false);\n  const [aggregatedPayments, setAggregatedPayments] = useState<any>(null);\n  const [isLoadingAggregated, setIsLoadingAggregated] = useState(false);\n  const [studentPaymentHistory, setStudentPaymentHistory] = useState<any[]>([]);\n  const [isLoadingReport, setIsLoadingReport] = useState(false);\n\n  useEffect(() => {\n    fetchDepartments();\n    fetchStudents();\n  }, []);\n\n  useEffect(() => {\n    fetchSemesters();\n  }, [selectedDepartment]);\n\n  // Fetch semesters when department changes\n  useEffect(() => {\n    if (selectedDepartment) {\n      fetchSemesters(selectedDepartment);\n      setSelectedSemester(null); // Reset semester when department changes\n    } else {\n      fetchSemesters(); // Fetch all semesters if no department selected\n    }\n  }, [selectedDepartment]);\n\n  useEffect(() => {\n    if (selectedDepartment && selectedSemester) {\n      fetchStudentFeeStatuses();\n    } else {\n      setFees([]);\n      setStudentFeeStatuses([]);\n      setFilteredStudentFeeStatuses([]);\n    }\n  }, [selectedDepartment, selectedSemester]);\n\n  useEffect(() => {\n    filterFees();\n  }, [fees, statusFilter]);\n\n  // Filter students based on selected department, semester, and fee status\n  useEffect(() => {\n    let filtered = students;\n    if (selectedDepartment) {\n      filtered = filtered.filter(student => student.department_id === selectedDepartment);\n    }\n    if (selectedSemester) {\n      filtered = filtered.filter(student => student.semester_id === selectedSemester);\n    }\n    setFilteredStudents(filtered);\n  }, [students, selectedDepartment, selectedSemester]);\n\n  // Filter student fee statuses based on status filter\n  useEffect(() => {\n    let filtered = studentFeeStatuses;\n    if (statusFilter !== 'All') {\n      filtered = filtered.filter(student =>\n        student.fee_info && student.fee_info.status === statusFilter\n      );\n    }\n    setFilteredStudentFeeStatuses(filtered);\n  }, [studentFeeStatuses, statusFilter]);\n\n  // Fetch student details when selectedStudent changes\n  useEffect(() => {\n    if (selectedStudent) {\n      fetchStudent(selectedStudent).then(() => {\n        fetchStudents(); // Refetch all students to include any newly added ones\n      });\n    } else {\n      setSelectedDepartment(null);\n      setSelectedSemester(null);\n    }\n  }, [selectedStudent]);\n\n  // Fetch aggregated payments when department and semester change\n  useEffect(() => {\n    if (selectedDepartment && selectedSemester && activeTab === 'history') {\n      fetchAggregatedPayments();\n    } else {\n      setAggregatedPayments(null);\n    }\n  }, [selectedDepartment, selectedSemester, activeTab]);\n\n  const fetchDepartments = async () => {\n    try {\n      const response = await academicsService.getDepartments();\n      console.log('Departments fetched:', response.data);\n      setDepartments(response.data);\n    } catch (err) {\n      console.error('Failed to fetch departments:', err);\n    }\n  };\n\n  const fetchSemesters = async (departmentId?: number) => {\n    try {\n      if (departmentId) {\n        const response = await academicsService.getSemestersByDepartment(departmentId);\n        setSemesters(response.data);\n      } else {\n        setSemesters([]); // Do not fetch all semesters if no department is selected\n      }\n    } catch (err) {\n      console.error('Failed to fetch semesters:', err);\n      setSemesters([]);\n    }\n  };\n\n  const fetchStudents = async () => {\n    setIsLoadingStudents(true);\n    setStudentError(null);\n    try {\n      const response = await academicsService.getStudents();\n      // Validate and clean student data\n      const validStudents = response.data.filter((student: any) => {\n        if (!student.id) {\n          console.warn('Student missing id:', student);\n          return false;\n        }\n        return true;\n      }).map((student: any) => ({\n        ...student,\n        first_name: student.first_name || '',\n        last_name: student.last_name || '',\n        name: student.name || '',\n        registration_number: student.registration_number || 'N/A',\n        department_id: student.department_id || null,\n        semester_id: student.semester_id || null,\n      }));\n      setStudents(validStudents);\n    } catch (err: any) {\n      console.error('Failed to fetch students:', err);\n      setStudentError(err.message || 'Failed to load students. Please try again.');\n    } finally {\n      setIsLoadingStudents(false);\n    }\n  };\n\n\n  const fetchStudentFees = async (studentId: number) => {\n    try {\n      const response = await academicsService.getStudentFees(studentId);\n      setFees(response.data.fees || []);\n    } catch (err) {\n      console.error('Failed to fetch student fees:', err);\n    }\n  };\n\n  const fetchStudentFeeStatuses = async () => {\n    if (!selectedDepartment || !selectedSemester) return;\n\n    try {\n      const response = await api.get(`academics/departments/${selectedDepartment}/semesters/${selectedSemester}/students/fees/`);\n      const students = response.data.students || [];\n      setStudentFeeStatuses(students);\n      setFilteredStudentFeeStatuses(students); // Initially show all\n      // Extract fees from student fee statuses for the fee records table\n      const feeList = students.filter((s: any) => s.fee_info && s.fee_info.fee_id).map((s: any) => s.fee_info);\n      setFees(feeList);\n    } catch (err) {\n      console.error('Failed to fetch student fee statuses:', err);\n      setStudentFeeStatuses([]);\n      setFilteredStudentFeeStatuses([]);\n      setFees([]);\n    }\n  };\n\n  const fetchAggregatedPayments = async () => {\n    if (!selectedDepartment || !selectedSemester) return;\n\n    setIsLoadingAggregated(true);\n    try {\n      const response = await api.get(`academics/departments/${selectedDepartment}/semesters/${selectedSemester}/payments/`);\n      setAggregatedPayments(response.data);\n    } catch (err) {\n      console.error('Failed to fetch aggregated payments:', err);\n      setAggregatedPayments(null);\n    } finally {\n      setIsLoadingAggregated(false);\n    }\n  };\n\n  const fetchPaymentHistory = async (feeId: number) => {\n    try {\n      const response = await api.get(`academics/fees/${feeId}/payments/`);\n      setPaymentHistory(response.data || []);\n      setShowPaymentHistoryModal(true);\n    } catch (err) {\n      console.error('Failed to fetch payment history:', err);\n      setPaymentHistory([]);\n    }\n  };\n\n  const handleCreateFee = async () => {\n    if (!newFeeData.student_id || !newFeeData.term || !newFeeData.amount || !newFeeData.due_date) {\n      setError('All fields are required');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    try {\n      const feeData = {\n        student_id: parseInt(newFeeData.student_id),\n        term: newFeeData.term,\n        amount: parseFloat(newFeeData.amount),\n        due_date: newFeeData.due_date\n      };\n\n      await academicsService.createStudentFee(parseInt(newFeeData.student_id), feeData);\n\n      // Refresh fees if we're viewing this student's fees\n      if (selectedStudent === parseInt(newFeeData.student_id)) {\n        await fetchStudentFees(selectedStudent);\n      }\n\n      setShowAddFeeModal(false);\n      setNewFeeData({\n        student_id: '',\n        term: '',\n        amount: '',\n        due_date: ''\n      });\n    } catch (err: any) {\n      setError(err.message || 'Failed to create fee record');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCreateDepartmentFee = async () => {\n    if (!departmentFeeData.department_id || !departmentFeeData.semester_id || !departmentFeeData.due_date) {\n      setError('Department, semester, and due date are required');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    try {\n      const feeData = {\n        semester_id: parseInt(departmentFeeData.semester_id),\n        due_date: departmentFeeData.due_date\n      };\n\n      // Use the api service which handles authentication automatically\n      const response = await api.post(`academics/departments/${departmentFeeData.department_id}/create-fees/`, feeData);\n\n      // Refresh fees and student statuses if we're viewing this department's fees\n      if (selectedDepartment === parseInt(departmentFeeData.department_id)) {\n        await fetchStudentFeeStatuses();\n      }\n\n      setShowDepartmentFeeModal(false);\n      setDepartmentFeeData({\n        department_id: '',\n        semester_id: '',\n        amount: '',\n        due_date: ''\n      });\n\n      alert(`Successfully created ${response.data.fees.length} fee records for the department with default amounts!`);\n    } catch (err: any) {\n      setError(err.message || 'Failed to create department fee records');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const generateReport = async () => {\n    setIsLoadingReport(true);\n    try {\n      let reportFees: Fee[] = [];\n\n      if (selectedStudent) {\n        // Generate report for specific student\n        const response = await academicsService.getStudentFees(selectedStudent);\n        reportFees = response.data.fees || [];\n      } else if (selectedDepartment && selectedSemester) {\n        // Generate report for department/semester\n        reportFees = fees; // Use fees already fetched from studentFeeStatuses\n      } else {\n        throw new Error('Please select a student or department and semester to generate report');\n      }\n\n      // Calculate aggregates\n      const totalFees = reportFees.length;\n      const totalAmount = reportFees.reduce((sum, fee) => sum + parseFloat(fee.amount), 0);\n      const totalPaid = reportFees.reduce((sum, fee) => sum + parseFloat(fee.paid_amount), 0);\n      const totalBalance = reportFees.reduce((sum, fee) => sum + fee.balance, 0);\n\n      // Status breakdown\n      const statusBreakdown = {\n        paid: reportFees.filter(fee => fee.status === 'Paid').length,\n        unpaid: reportFees.filter(fee => fee.status === 'Unpaid').length,\n        partial: reportFees.filter(fee => fee.status === 'Partial').length\n      };\n\n      // Find student if selected\n      const student = selectedStudent ? students.find(s => s.id === selectedStudent) : null;\n\n      const reportData = {\n        totalFees,\n        totalAmount,\n        totalPaid,\n        totalBalance,\n        statusBreakdown,\n        generatedAt: new Date().toLocaleString(),\n        department: selectedDepartment ? departments.find(d => d.id === selectedDepartment)?.name : 'All Departments',\n        semester: selectedSemester ? semesters.find(s => s.id === selectedSemester)?.name : 'All Semesters',\n        student: student,\n        fees: reportFees\n      };\n\n      if (selectedStudent) {\n        // Show receipt for individual student\n        const student = students.find(s => s.id === selectedStudent);\n        if (student && reportFees.length > 0) {\n          setReceiptData({\n            student,\n            fee: reportFees[0],\n            payments: [],\n            generatedAt: reportData.generatedAt,\n            totalPaid: reportData.totalPaid,\n            balance: reportData.totalBalance,\n            semester: reportData.semester\n          });\n          setShowGenerateReceiptModal(true);\n        }\n      } else {\n        // Show report for department/semester\n        setReportData(reportData);\n        setShowReportModal(true);\n      }\n    } catch (err: any) {\n      console.error('Failed to generate report:', err);\n      setError(err.message || 'Failed to generate report');\n    } finally {\n      setIsLoadingReport(false);\n    }\n  };\n\n  const generateStudentReceipt = async (studentId: number) => {\n    try {\n      const student = students.find(s => s.id === studentId);\n      if (!student) {\n        setError('Student not found');\n        return;\n      }\n\n      const response = await academicsService.getStudentFees(studentId);\n      const fees = response.data.fees || [];\n\n      if (fees.length === 0) {\n        setError('No fee records found for this student');\n        return;\n      }\n\n      // Get payment history for the latest fee\n      const latestFee = fees[0]; // Assuming fees are ordered by most recent\n      if (!latestFee || !latestFee.fee_id || typeof latestFee.fee_id !== 'number' || latestFee.fee_id <= 0) {\n        setError('No valid fee record found for this student');\n        return;\n      }\n      const paymentResponse = await api.get(`academics/fees/${latestFee.fee_id}/payments/`);\n      const payments = paymentResponse.data || [];\n\n      const receiptData = {\n        student,\n        fee: latestFee,\n        payments,\n        generatedAt: new Date().toLocaleString(),\n        totalPaid: parseFloat(latestFee.paid_amount),\n        balance: latestFee.balance,\n        semester: semesters.find(s => s.id === latestFee.semester)?.name || 'Unknown Semester'\n      };\n\n      setReceiptData(receiptData);\n      setShowGenerateReceiptModal(true);\n    } catch (err: any) {\n      console.error('Failed to generate receipt:', err);\n      setError(err.message || 'Failed to generate receipt');\n    }\n  };\n\n  const fetchStudent = async (studentId: number) => {\n    try {\n      const response = await academicsService.getStudent(studentId.toString());\n      const student = response.data;\n      setSelectedDepartment(student.department_id);\n      setSelectedSemester(student.semester_id);\n    } catch (err) {\n      console.error('Failed to fetch student:', err);\n    }\n  };\n\n  const filterFees = () => {\n    let filtered = fees;\n    // No need to filter by student since fees are already fetched for selected student\n    if (statusFilter !== 'All') {\n      filtered = filtered.filter(fee => fee.status === statusFilter);\n    }\n    setFilteredFees(filtered);\n  };\n\n  const handlePayment = async () => {\n    if (!selectedFee || !paymentAmount) return;\n\n    const amount = parseFloat(paymentAmount);\n    if (amount <= 0) {\n      setError('Payment amount must be greater than 0');\n      return;\n    }\n\n    const currentPaid = parseFloat(selectedFee.paid_amount);\n    const totalAmount = parseFloat(selectedFee.amount);\n    const newPaidAmount = currentPaid + amount;\n\n    if (newPaidAmount > totalAmount) {\n      setError('Payment amount exceeds remaining balance');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    try {\n      let newStatus: 'Paid' | 'Unpaid' | 'Partial';\n      if (newPaidAmount >= totalAmount) {\n        newStatus = 'Paid';\n      } else if (newPaidAmount > 0) {\n        newStatus = 'Partial';\n      } else {\n        newStatus = 'Unpaid';\n      }\n\n      const updatedFee: Fee = {\n        ...selectedFee,\n        paid_amount: newPaidAmount.toString(),\n        status: newStatus,\n        paid_on: new Date().toISOString().split('T')[0],\n      };\n\n      // Create payment record\n      const paymentData = {\n        amount: amount,\n        payment_method: paymentMethod,\n        notes: `Payment for ${semesters.find(s => s.id === selectedFee.semester)?.name || 'Unknown Semester'}`\n      };\n\n      await api.post(`academics/fees/${selectedFee.fee_id}/payments/`, paymentData);\n\n      // Refresh fees and student statuses\n      if (selectedDepartment && selectedSemester) {\n        await fetchStudentFeeStatuses();\n      }\n\n      // Set last payment for receipt\n      setLastPayment({\n        amount: amount,\n        date: new Date().toLocaleDateString()\n      });\n\n      setIsModalOpen(false);\n      setShowReceipt(true);\n      setSelectedFee(null);\n      setPaymentAmount('');\n      setPaymentMethod('Cash');\n    } catch (err: any) {\n      setError(err.message || 'Failed to process payment');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const openPaymentModal = (fee: Fee) => {\n    setSelectedFee(fee);\n    setPaymentAmount('');\n    setPaymentMethod('Cash');\n    setIsModalOpen(true);\n  };\n\n  const openPaymentHistoryModal = (feeId: number) => {\n    if (feeId) {\n      fetchPaymentHistory(feeId);\n    } else {\n      console.error('Invalid fee ID for payment history');\n    }\n  };\n\n  const formatStudentName = (student: Student) => {\n    if (student.first_name && student.last_name) {\n      return `${student.first_name.trim()} ${student.last_name.trim()}`;\n    } else if (student.name) {\n      return student.name.trim();\n    } else {\n      return 'Unknown Student';\n    }\n  };\n\n  const capitalizeFirstLetter = (str: string) => {\n    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n  };\n\n\n  console.log('Rendering FeeManagement with departments:', departments);\n\n  return (\n    <div className=\"p-4 md:p-6 max-w-7xl mx-auto\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center\">\n          <FontAwesomeIcon icon={faCreditCard} className=\"text-indigo-600 text-3xl mr-3\" />\n          <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800\">Fee Management</h1>\n        </div>\n        <div className=\"flex space-x-3\">\n          <button\n            onClick={() => generateReport()}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200\"\n          >\n            <FontAwesomeIcon icon={faFileAlt} className=\"mr-2\" />\n            Generate Report\n          </button>\n          <button\n            onClick={() => setShowDepartmentFeeModal(true)}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-200\"\n          >\n            <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />\n            Add Department Fee\n          </button>\n        </div>\n      </div>\n\n      {error && (\n        <div className=\"bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-r-lg flex items-center\">\n          <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-red-500 mr-3\" />\n          <span className=\"text-red-700\">{error}</span>\n        </div>\n      )}\n\n      {studentError && (\n        <div className=\"bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-r-lg flex items-center\">\n          <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-red-500 mr-3\" />\n          <span className=\"text-red-700\">Student Data Error: {studentError}</span>\n        </div>\n      )}\n\n      <div className=\"mb-6 bg-white p-4 rounded-lg shadow-sm\">\n        <div className=\"flex items-center mb-4\">\n          <FontAwesomeIcon icon={faFilter} className=\"text-gray-600 mr-2\" />\n          <h2 className=\"text-lg font-semibold text-gray-700\">Filters</h2>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\n          <div>\n            <label className=\"block text-gray-700 text-sm font-bold mb-2\">Select Student</label>\n            {isLoadingStudents ? (\n              <div className=\"flex justify-center items-center h-10\">\n                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600\"></div>\n                <span className=\"ml-2 text-gray-600\">Loading students...</span>\n              </div>\n            ) : studentError ? (\n              <div className=\"border rounded p-2 bg-red-50 text-red-700\">\n                <FontAwesomeIcon icon={faExclamationTriangle} className=\"mr-2\" />\n                {studentError}\n              </div>\n            ) : (\n              <SearchableStudentSelect\n                students={filteredStudents}\n                selectedStudent={selectedStudent}\n                onStudentSelect={setSelectedStudent}\n                disabled={filteredStudents.length === 0}\n              />\n            )}\n          </div>\n\n          <div>\n            <label className=\"block text-gray-700 text-sm font-bold mb-2\">Select Department</label>\n            <select\n              value={selectedDepartment || ''}\n              onChange={(e) => {\n                setSelectedDepartment(e.target.value ? parseInt(e.target.value) : null);\n                setSelectedStudent(null); // Reset student selection when department changes\n              }}\n              disabled={!!selectedStudent}\n              className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            >\n              <option value=\"\">\n                {selectedStudent ? 'Auto-selected from student' : 'Choose a department...'}\n              </option>\n              {departments.map(dept => (\n                <option key={dept.id} value={dept.id}>\n                  {dept.name}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-gray-700 text-sm font-bold mb-2\">Select Semester</label>\n            <select\n              value={selectedSemester || ''}\n              onChange={(e) => {\n                setSelectedSemester(e.target.value ? parseInt(e.target.value) : null);\n                setSelectedStudent(null); // Reset student selection when semester changes\n              }}\n              disabled={!selectedDepartment}\n              className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n            >\n              <option value=\"\">\n                {selectedStudent ? 'Auto-selected from student' : selectedDepartment ? (semesters.length > 0 ? 'Choose a semester...' : 'No semesters available for this department') : 'Select department first'}\n              </option>\n              {semesters.map(sem => (\n                <option key={sem.id} value={sem.id}>\n                  {sem.name} ({sem.semester_code})\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-gray-700 text-sm font-bold mb-2\">Filter by Status</label>\n            <select\n              value={statusFilter}\n              onChange={(e) => setStatusFilter(e.target.value)}\n              className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            >\n              <option value=\"All\">All</option>\n              <option value=\"Paid\">Paid</option>\n              <option value=\"Unpaid\">Unpaid</option>\n              <option value=\"Partial\">Partial</option>\n            </select>\n          </div>\n        </div>\n\n        {(selectedDepartment && selectedSemester) && (\n          <div className=\"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200\">\n            <p className=\"text-sm text-blue-800\">\n              <strong>Selected:</strong> {departments.find(d => d.id === selectedDepartment)?.name} - {semesters.find(s => s.id === selectedSemester)?.name}\n              {filteredStudents.length > 0 && (\n                <span className=\"ml-2\">({filteredStudents.length} students found)</span>\n              )}\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Tab Navigation */}\n      <div className=\"bg-white rounded-lg shadow-sm mb-6\">\n        <div className=\"border-b border-gray-200\">\n          <nav className=\"-mb-px flex space-x-8 px-6\">\n            <button\n              onClick={() => setActiveTab('payment')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'payment'\n                  ? 'border-indigo-500 text-indigo-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />\n              Fee Payment\n            </button>\n            <button\n              onClick={() => setActiveTab('status')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'status'\n                  ? 'border-indigo-500 text-indigo-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <FontAwesomeIcon icon={faMoneyBillWave} className=\"mr-2\" />\n              Student Status\n            </button>\n            <button\n              onClick={() => setActiveTab('history')}\n              className={`py-4 px-1 border-b-2 font-medium text-sm ${\n                activeTab === 'history'\n                  ? 'border-indigo-500 text-indigo-600'\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n              }`}\n            >\n              <FontAwesomeIcon icon={faHistory} className=\"mr-2\" />\n              Payment History\n            </button>\n          </nav>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center items-center h-64\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600\"></div>\n        </div>\n      ) : !selectedDepartment || !selectedSemester ? (\n        <div className=\"bg-white rounded-lg shadow-sm p-8 text-center\">\n          <FontAwesomeIcon icon={faFilter} className=\"text-gray-400 text-4xl mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Select Department and Semester</h3>\n          <p className=\"text-gray-600\">Please select a department and semester above to view and manage student fees.</p>\n        </div>\n      ) : activeTab === 'payment' ? (\n        /* Fee Payment Tab */\n        <div className=\"bg-white rounded-lg shadow-sm p-8\">\n          <div className=\"text-center\">\n            <FontAwesomeIcon icon={faCreditCard} className=\"text-green-600 text-4xl mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Fee Payment Processing</h3>\n            <p className=\"text-gray-600 mb-6\">Process fee payments for students. All fees are now standardized at $30,000 per semester.</p>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto\">\n              <button\n                onClick={() => {\n                  const unpaidStudents = studentFeeStatuses.filter(s =>\n                    s.fee_info && (s.fee_info.status === 'Unpaid' || s.fee_info.status === 'Partial')\n                  );\n                  if (unpaidStudents.length === 0) {\n                    alert('No unpaid fees found for this department and semester.');\n                    return;\n                  }\n                  setSelectedStudentsForPayment(unpaidStudents.map(s => s.id));\n                  setShowBulkPaymentModal(true);\n                }}\n                className=\"p-6 border-2 border-dashed border-green-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors duration-200\"\n              >\n                <FontAwesomeIcon icon={faMoneyBillWave} className=\"text-green-600 text-2xl mb-3\" />\n                <h4 className=\"text-lg font-medium text-gray-900 mb-2\">Bulk Payment Processing</h4>\n                <p className=\"text-sm text-gray-600\">Process payments for multiple students at once</p>\n              </button>\n\n              <button\n                onClick={() => setActiveTab('status')}\n                className=\"p-6 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors duration-200\"\n              >\n                <FontAwesomeIcon icon={faCreditCard} className=\"text-blue-600 text-2xl mb-3\" />\n                <h4 className=\"text-lg font-medium text-gray-900 mb-2\">Individual Payments</h4>\n                <p className=\"text-sm text-gray-600\">Process payments for individual students</p>\n              </button>\n            </div>\n\n            <div className=\"mt-8 bg-blue-50 p-4 rounded-lg\">\n              <h4 className=\"text-md font-semibold text-blue-800 mb-2\">Fee Structure Information</h4>\n              <p className=\"text-sm text-blue-700\">\n                All department-semester combinations now have a standardized fee of <strong>$30,000</strong>.\n                Fee records are automatically created for students based on their department and semester enrollment.\n              </p>\n            </div>\n          </div>\n        </div>\n      ) : activeTab === 'status' ? (\n        /* Student Status Tab */\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\n          {!selectedDepartment || !selectedSemester ? (\n            <div className=\"p-8 text-center\">\n              <FontAwesomeIcon icon={faFilter} className=\"text-gray-400 text-4xl mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Select Department and Semester</h3>\n              <p className=\"text-gray-600\">Please select a department and semester above to view student fee status.</p>\n            </div>\n          ) : filteredStudentFeeStatuses.length === 0 ? (\n            <div className=\"p-8 text-center\">\n              <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-yellow-400 text-4xl mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Students Found</h3>\n              <p className=\"text-gray-600\">\n                {statusFilter === 'All'\n                  ? 'No students found for the selected department and semester combination.'\n                  : `No students found with \"${statusFilter}\" fee status for the selected department and semester.`\n                }\n              </p>\n            </div>\n          ) : (\n            <>\n              <div className=\"px-6 py-4 border-b border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h3 className=\"text-lg font-medium text-gray-900\">\n                      Student Fee Status ({filteredStudentFeeStatuses.length} students)\n                    </h3>\n                    <p className=\"text-sm text-gray-600\">\n                      {departments.find(d => d.id === selectedDepartment)?.name} - {semesters.find(s => s.id === selectedSemester)?.name}\n                    </p>\n                  </div>\n                  <div className=\"flex space-x-3\">\n                    <button\n                      onClick={() => {\n                        const unpaidStudents = filteredStudentFeeStatuses.filter(s =>\n                          s.fee_info && (s.fee_info.status === 'Unpaid' || s.fee_info.status === 'Partial')\n                        );\n                        if (unpaidStudents.length === 0) {\n                          alert('No unpaid fees found for this department and semester.');\n                          return;\n                        }\n                        setSelectedStudentsForPayment(unpaidStudents.map(s => s.id));\n                        setShowBulkPaymentModal(true);\n                      }}\n                      className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200\"\n                    >\n                      <FontAwesomeIcon icon={faMoneyBillWave} className=\"mr-2\" />\n                      Bulk Pay Selected\n                    </button>\n                    <button\n                      onClick={() => {\n                        if (selectedStudentsForPayment.length === 0) {\n                          alert('Please select students first.');\n                          return;\n                        }\n                        setShowBulkPaymentModal(true);\n                      }}\n                      disabled={selectedStudentsForPayment.length === 0}\n                      className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200\"\n                    >\n                      <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />\n                      Pay Selected ({selectedStudentsForPayment.length})\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"divide-y divide-gray-200\">\n                {filteredStudentFeeStatuses.map((studentData, index) => (\n                  <div key={studentData.id || index} className=\"p-6 hover:bg-gray-50 transition-colors duration-200\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center flex-1\">\n                        {studentData.fee_info && studentData.fee_info.fee_id && (studentData.fee_info.status === 'Unpaid' || studentData.fee_info.status === 'Partial') && (\n                          <div className=\"mr-4\">\n                            <input\n                              type=\"checkbox\"\n                              checked={selectedStudentsForPayment.includes(studentData.id)}\n                              onChange={(e) => {\n                                if (e.target.checked) {\n                                  setSelectedStudentsForPayment([...selectedStudentsForPayment, studentData.id]);\n                                } else {\n                                  setSelectedStudentsForPayment(selectedStudentsForPayment.filter(id => id !== studentData.id));\n                                }\n                              }}\n                              className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n                            />\n                          </div>\n                        )}\n                        <div className=\"flex-shrink-0\">\n                          <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${\n                            studentData.fee_info?.status === 'Paid' ? 'bg-green-500' :\n                            studentData.fee_info?.status === 'Partial' ? 'bg-yellow-500' :\n                            'bg-red-500'\n                          }`}>\n                            {studentData.first_name?.charAt(0) || studentData.name?.charAt(0) || '?'}\n                          </div>\n                        </div>\n                        <div className=\"ml-4 flex-1\">\n                          <h4 className=\"text-lg font-medium text-gray-900\">\n                            {formatStudentName(studentData)}\n                          </h4>\n                          <p className=\"text-sm text-gray-600\">\n                            Registration: {studentData.registration_number || 'N/A'}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-4\">\n                        {studentData.fee_info && studentData.fee_info.fee_id ? (\n                          <>\n                            <div className=\"text-right\">\n                              <div className=\"text-sm text-gray-900\">\n                                <span className=\"font-medium\">${studentData.fee_info.amount}</span> total\n                              </div>\n                              <div className=\"text-sm text-gray-600\">\n                                ${studentData.fee_info.balance?.toFixed(2) || '0.00'} remaining\n                              </div>\n                            </div>\n                            <div className=\"flex items-center\">\n                              <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n                                studentData.fee_info.status === 'Paid' ? 'bg-green-100 text-green-800' :\n                                studentData.fee_info.status === 'Unpaid' ? 'bg-red-100 text-red-800' :\n                                'bg-yellow-100 text-yellow-800'\n                              }`}>\n                                {studentData.fee_info.status === 'Paid' && <FontAwesomeIcon icon={faCheckCircle} className=\"mr-1\" />}\n                                {studentData.fee_info.status}\n                              </span>\n                            </div>\n                            <div className=\"flex space-x-2\">\n                              {(studentData.fee_info.status === 'Unpaid' || studentData.fee_info.status === 'Partial') && (\n                                <button\n                                  onClick={() => {\n                                    const fee = studentData.fee_info;\n                                    setSelectedFee({\n                                      ...fee,\n                                      student: studentData.id,\n                                      semester: selectedSemester,\n                                      department_id: selectedDepartment,\n                                      semester_id: selectedSemester\n                                    });\n                                    setIsModalOpen(true);\n                                  }}\n                                  className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200\"\n                                >\n                                  <FontAwesomeIcon icon={faCreditCard} className=\"mr-1\" />\n                                  Pay Now\n                                </button>\n                              )}\n                              <button\n                                onClick={() => openPaymentHistoryModal(studentData.fee_info.fee_id)}\n                                className=\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200\"\n                              >\n                                <FontAwesomeIcon icon={faHistory} className=\"mr-2\" />\n                                History\n                              </button>\n                              <button\n                                onClick={() => generateStudentReceipt(studentData.id)}\n                                className=\"inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200\"\n                              >\n                                <FontAwesomeIcon icon={faFileAlt} className=\"mr-2\" />\n                                Receipt\n                              </button>\n                            </div>\n                          </>\n                        ) : (\n                          <div className=\"text-right\">\n                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800\">\n                              No Fee Record\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n        </div>\n      ) : activeTab === 'history' ? (\n        /* Payment History Tab */\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <h3 className=\"text-lg font-medium text-gray-900\">\n              Payment History - All Students\n            </h3>\n            <p className=\"text-sm text-gray-600\">\n              {departments.find(d => d.id === selectedDepartment)?.name} - {semesters.find(s => s.id === selectedSemester)?.name}\n            </p>\n          </div>\n\n          {!selectedDepartment || !selectedSemester ? (\n            <div className=\"p-8 text-center\">\n              <FontAwesomeIcon icon={faFilter} className=\"text-gray-400 text-4xl mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Select Department and Semester</h3>\n              <p className=\"text-gray-600\">Please select a department and semester above to view payment history.</p>\n            </div>\n          ) : filteredStudentFeeStatuses.length === 0 ? (\n            <div className=\"p-8 text-center\">\n              <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-yellow-400 text-4xl mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Students Found</h3>\n              <p className=\"text-gray-600\">\n                {statusFilter === 'All'\n                  ? 'No students found for the selected department and semester combination.'\n                  : `No students found with \"${statusFilter}\" fee status for the selected department and semester.`\n                }\n              </p>\n            </div>\n          ) : (\n            <>\n              {/* Aggregated Payments Section */}\n              {isLoadingAggregated ? (\n                <div className=\"p-8 text-center\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\n                  <p className=\"text-gray-600\">Loading aggregated payment history...</p>\n                </div>\n              ) : aggregatedPayments ? (\n                <div className=\"p-6 bg-blue-50 border-b border-blue-200\">\n                  <h4 className=\"text-md font-semibold text-blue-800 mb-3\">Aggregated Payment Summary</h4>\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n                    <div className=\"bg-white p-3 rounded-lg shadow-sm\">\n                      <div className=\"text-2xl font-bold text-blue-600\">{aggregatedPayments.total_payments}</div>\n                      <div className=\"text-sm text-blue-800\">Total Payments</div>\n                    </div>\n                    <div className=\"bg-white p-3 rounded-lg shadow-sm\">\n                      <div className=\"text-2xl font-bold text-green-600\">${aggregatedPayments.total_amount?.toFixed(2) || '0.00'}</div>\n                      <div className=\"text-sm text-green-800\">Total Collected</div>\n                    </div>\n                    <div className=\"bg-white p-3 rounded-lg shadow-sm\">\n                      <div className=\"text-2xl font-bold text-indigo-600\">{aggregatedPayments.payments?.length || 0}</div>\n                      <div className=\"text-sm text-indigo-800\">Payment Records</div>\n                    </div>\n                  </div>\n\n                  {aggregatedPayments.payments && aggregatedPayments.payments.length > 0 && (\n                    <div className=\"overflow-x-auto mb-4\">\n                      <table className=\"min-w-full divide-y divide-gray-200\">\n                        <thead className=\"bg-blue-100\">\n                          <tr>\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\">Student</th>\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\">Amount</th>\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\">Date</th>\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-blue-900 uppercase tracking-wider\">Method</th>\n                          </tr>\n                        </thead>\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\n                          {aggregatedPayments.payments.slice(0, 10).map((payment: any, index: number) => (\n                            <tr key={payment.payment_id || index} className=\"hover:bg-gray-50\">\n                              <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-900\">{payment.student_name}</td>\n                              <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium text-green-600\">${payment.amount}</td>\n                              <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-900\">{new Date(payment.payment_date).toLocaleDateString()}</td>\n                              <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-900\">{payment.payment_method || 'N/A'}</td>\n                            </tr>\n                          ))}\n                          {aggregatedPayments.payments.length > 10 && (\n                            <tr>\n                              <td colSpan={4} className=\"px-4 py-3 text-center text-sm text-gray-500\">\n                                Showing first 10 of {aggregatedPayments.payments.length} payments.\n                              </td>\n                            </tr>\n                          )}\n                        </tbody>\n                      </table>\n                    </div>\n                  )}\n                </div>\n              ) : null}\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Semester</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Paid</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Balance</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Due Date</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {filteredStudentFeeStatuses.map((studentData, index) => (\n                      <tr key={studentData.id || index} className=\"hover:bg-gray-50 transition-colors duration-200\">\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {formatStudentName(studentData)}\n                        </td>\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {semesters.find(s => s.id === selectedSemester)?.name || 'Unknown Semester'}\n                        </td>\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          ${studentData.fee_info?.amount || '0.00'}\n                        </td>\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          ${studentData.fee_info?.paid_amount || '0.00'}\n                        </td>\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          ${studentData.fee_info?.balance?.toFixed(2) || '0.00'}\n                        </td>\n                        <td className=\"px-4 py-4 whitespace-nowrap\">\n                          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                            studentData.fee_info?.status === 'Paid' ? 'bg-green-100 text-green-800' :\n                            studentData.fee_info?.status === 'Unpaid' ? 'bg-red-100 text-red-800' :\n                            'bg-yellow-100 text-yellow-800'\n                          }`}>\n                            {studentData.fee_info?.status || 'No Fee Record'}\n                          </span>\n                        </td>\n                        <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {studentData.fee_info?.due_date || 'N/A'}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </>\n          )}\n        </div>\n      ) : (\n        /* History Tab */\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\n          <div className=\"px-6 py-4 border-b border-gray-200\">\n            <h3 className=\"text-lg font-medium text-gray-900\">\n              Fee Records ({filteredFees.length} records)\n            </h3>\n            <p className=\"text-sm text-gray-600\">\n              {departments.find(d => d.id === selectedDepartment)?.name} - {semesters.find(s => s.id === selectedSemester)?.name}\n            </p>\n          </div>\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Semester</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Paid Amount</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Balance</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Due Date</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Last Payment</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Actions</th>\n                  <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Receipt</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {filteredFees.map(fee => {\n                  const student = students.find(s => s.id === fee.student);\n                  return (\n                    <tr key={fee.fee_id} className=\"hover:bg-gray-50 transition-colors duration-200\">\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {student ? formatStudentName(student) : 'Unknown Student'}\n                      </td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {semesters.find(s => s.id === fee.semester)?.name || 'Unknown Semester'}\n                      </td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">${fee.amount}</td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">${fee.paid_amount}</td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">${fee.balance.toFixed(2)}</td>\n                      <td className=\"px-4 py-4 whitespace-nowrap\">\n                        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                          fee.status === 'Paid' ? 'bg-green-100 text-green-800' :\n                          fee.status === 'Unpaid' ? 'bg-red-100 text-red-800' :\n                          'bg-yellow-100 text-yellow-800'\n                        }`}>\n                          {fee.status === 'Paid' && <FontAwesomeIcon icon={faCheckCircle} className=\"mr-1\" />}\n                          {fee.status}\n                        </span>\n                      </td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">{fee.due_date}</td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {fee.paid_on ? new Date(fee.paid_on).toLocaleDateString() : 'No payments'}\n                      </td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\n                        <button\n                          onClick={() => openPaymentHistoryModal(fee.fee_id)}\n                          className=\"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200\"\n                        >\n                          <FontAwesomeIcon icon={faHistory} className=\"mr-2\" />\n                          View History\n                        </button>\n                      </td>\n                      <td className=\"px-4 py-4 whitespace-nowrap text-sm font-medium\">\n                        <button\n                          onClick={() => generateStudentReceipt(fee.student)}\n                          className=\"inline-flex items-center px-3 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200\"\n                        >\n                          <FontAwesomeIcon icon={faFileAlt} className=\"mr-2\" />\n                          Receipt\n                        </button>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      )}\n\n      {isModalOpen && selectedFee && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center mb-4\">\n                <FontAwesomeIcon icon={faCreditCard} className=\"text-indigo-600 text-xl mr-2\" />\n                <h2 className=\"text-xl font-bold text-gray-800\">Make Payment</h2>\n              </div>\n              <div className=\"mb-4\">\n                <p className=\"text-gray-600\">Fee for <span className=\"font-semibold\">{semesters.find(s => s.id === selectedFee.semester)?.name || 'Unknown Semester'}</span></p>\n                <p className=\"text-gray-600\">Total Amount: <span className=\"font-semibold\">${selectedFee.amount}</span></p>\n                <p className=\"text-gray-600\">Balance: <span className=\"font-semibold\">${selectedFee.balance.toFixed(2)}</span></p>\n              </div>\n              <div className=\"mb-4 space-y-4\">\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Payment Amount</label>\n                  <input\n                    type=\"number\"\n                    value={paymentAmount}\n                    onChange={(e) => setPaymentAmount(e.target.value)}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                    placeholder=\"Enter amount\"\n                    min=\"0.01\"\n                    step=\"0.01\"\n                    max={selectedFee ? (parseFloat(selectedFee.amount) - parseFloat(selectedFee.paid_amount)).toFixed(2) : undefined}\n                  />\n                  {selectedFee && (\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Maximum: ${(parseFloat(selectedFee.amount) - parseFloat(selectedFee.paid_amount)).toFixed(2)}\n                    </p>\n                  )}\n                </div>\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Payment Method</label>\n                  <select\n                    value={paymentMethod}\n                    onChange={(e) => setPaymentMethod(e.target.value)}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n                  >\n                    <option value=\"Cash\">Cash</option>\n                    <option value=\"Online\">Online</option>\n                    <option value=\"Cheque\">Cheque</option>\n                  </select>\n                </div>\n              </div>\n              <div className=\"flex justify-end space-x-3\">\n                <button\n                  onClick={() => setIsModalOpen(false)}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handlePayment}\n                  disabled={isLoading || !paymentAmount}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 transition-colors duration-200\"\n                >\n                  {isLoading ? <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div> : <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />}\n                  {isLoading ? 'Processing...' : 'Pay'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showReceipt && selectedStudent && lastPayment && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-bold text-gray-800\">Payment Receipt</h2>\n                <button\n                  onClick={() => setShowReceipt(false)}\n                  className=\"text-gray-500 hover:text-gray-700\"\n                >\n                  <FontAwesomeIcon icon={faCheckCircle} size=\"lg\" />\n                </button>\n              </div>\n\n              <div className=\"border-t border-b border-gray-200 py-4 mb-4\">\n                <div className=\"text-center mb-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-800\">University Fee Payment</h3>\n                  <p className=\"text-sm text-gray-600\">Receipt #{Date.now()}</p>\n                </div>\n\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Student:</span>\n                    <span>{students.find(s => s.id === selectedStudent) ? formatStudentName(students.find(s => s.id === selectedStudent)!) : 'Unknown'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Registration:</span>\n                    <span>{students.find(s => s.id === selectedStudent)?.registration_number || 'N/A'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Semester:</span>\n                    <span>{semesters.find(s => s.id === selectedSemester)?.name || 'Unknown'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Payment Date:</span>\n                    <span>{lastPayment.date}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Amount Paid:</span>\n                    <span className=\"font-semibold text-green-600\">${lastPayment.amount.toFixed(2)}</span>\n                  </div>\n                  {(() => {\n                    const studentData = studentFeeStatuses.find(s => s.id === selectedStudent);\n                    if (studentData && studentData.fee_info && studentData.fee_info.payments && studentData.fee_info.payments.length > 0) {\n                      const firstPayment = studentData.fee_info.payments[0];\n                      return (\n                        <div className=\"flex justify-between\">\n                          <span className=\"font-medium\">First Payment:</span>\n                          <span className=\"text-xs text-gray-600\">\n                            ${firstPayment.amount} on {new Date(firstPayment.payment_date).toLocaleDateString()}\n                          </span>\n                        </div>\n                      );\n                    }\n                    return null;\n                  })()}\n                </div>\n              </div>\n\n              <div className=\"text-center\">\n                <p className=\"text-xs text-gray-500 mb-4\">\n                  Thank you for your payment. This receipt serves as proof of payment.\n                </p>\n                <button\n                  onClick={() => window.print()}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />\n                  Print Receipt\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showAddFeeModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center mb-4\">\n                <FontAwesomeIcon icon={faCreditCard} className=\"text-green-600 text-xl mr-2\" />\n                <h2 className=\"text-xl font-bold text-gray-800\">Add New Fee Record</h2>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Select Student</label>\n                  <select\n                    value={newFeeData.student_id}\n                    onChange={(e) => setNewFeeData({...newFeeData, student_id: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\"\n                  >\n                    <option value=\"\">Select a student...</option>\n                    {students.map(student => (\n                      <option key={student.id} value={student.id}>\n                        {capitalizeFirstLetter(formatStudentName(student))} ({student.registration_number})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Term</label>\n                  <input\n                    type=\"text\"\n                    value={newFeeData.term}\n                    onChange={(e) => setNewFeeData({...newFeeData, term: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\"\n                    placeholder=\"e.g., Fall-2024, Semester-1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Amount</label>\n                  <input\n                    type=\"number\"\n                    value={newFeeData.amount}\n                    onChange={(e) => setNewFeeData({...newFeeData, amount: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\"\n                    placeholder=\"Enter amount\"\n                    min=\"0.01\"\n                    step=\"0.01\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Due Date</label>\n                  <input\n                    type=\"date\"\n                    value={newFeeData.due_date}\n                    onChange={(e) => setNewFeeData({...newFeeData, due_date: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end space-x-3 mt-6\">\n                <button\n                  onClick={() => {\n                    setShowAddFeeModal(false);\n                    setNewFeeData({\n                      student_id: '',\n                      term: '',\n                      amount: '',\n                      due_date: ''\n                    });\n                  }}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleCreateFee}\n                  disabled={isLoading}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-colors duration-200\"\n                >\n                  {isLoading ? <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div> : <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />}\n                  {isLoading ? 'Creating...' : 'Create Fee'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showDepartmentFeeModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center mb-4\">\n                <FontAwesomeIcon icon={faCreditCard} className=\"text-purple-600 text-xl mr-2\" />\n                <h2 className=\"text-xl font-bold text-gray-800\">Add Department Fee</h2>\n              </div>\n\n              <div className=\"mb-4 p-3 bg-blue-50 rounded-lg\">\n                <p className=\"text-sm text-blue-800\">\n                  This will create fee records for ALL students in the selected department and semester with default amounts:\n                  <br /> Even semesters: $25,000\n                  <br /> Odd semesters: $30,000\n                </p>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Select Department</label>\n                  <select\n                    value={departmentFeeData.department_id}\n                    onChange={(e) => setDepartmentFeeData({...departmentFeeData, department_id: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                  >\n                    <option value=\"\">Select a department...</option>\n                    {departments.map(department => (\n                      <option key={department.id} value={department.id}>\n                        {department.name} ({department.code})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Semester</label>\n                  <select\n                    value={departmentFeeData.semester_id}\n                    onChange={(e) => setDepartmentFeeData({...departmentFeeData, semester_id: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                  >\n                    <option value=\"\">Select a semester...</option>\n                    {semesters.map(semester => (\n                      <option key={semester.id} value={semester.id}>\n                        {semester.name} ({semester.semester_code}) - Default: ${(parseInt(semester.name.split(' ')[1]) % 2 === 0 ? '25,000' : '30,000')}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Due Date</label>\n                  <input\n                    type=\"date\"\n                    value={departmentFeeData.due_date}\n                    onChange={(e) => setDepartmentFeeData({...departmentFeeData, due_date: e.target.value})}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end space-x-3 mt-6\">\n                <button\n                  onClick={() => {\n                    setShowDepartmentFeeModal(false);\n                    setDepartmentFeeData({\n                      department_id: '',\n                      semester_id: '',\n                      amount: '',\n                      due_date: ''\n                    });\n                  }}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-200\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={handleCreateDepartmentFee}\n                  disabled={isLoading}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 transition-colors duration-200\"\n                >\n                  {isLoading ? <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div> : <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />}\n                  {isLoading ? 'Creating...' : 'Create Department Fees'}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showReportModal && reportData && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center\">\n                  <FontAwesomeIcon icon={faFileAlt} className=\"text-blue-600 text-xl mr-2\" />\n                  <h2 className=\"text-xl font-bold text-gray-800\">Fee Report</h2>\n                </div>\n                <div className=\"flex space-x-2\">\n                  <button\n                    onClick={() => window.print()}\n                    className=\"inline-flex items-center px-3 py-1 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                  >\n                    <FontAwesomeIcon icon={faFileAlt} className=\"mr-2\" />\n                    Print\n                  </button>\n                  <button\n                    onClick={() => setShowReportModal(false)}\n                    className=\"text-gray-500 hover:text-gray-700\"\n                  >\n                    <FontAwesomeIcon icon={faCheckCircle} size=\"lg\" />\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"mb-6\">\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n                  <div className=\"bg-blue-50 p-3 rounded-lg\">\n                    <div className=\"text-2xl font-bold text-blue-600\">{reportData.totalFees}</div>\n                    <div className=\"text-sm text-blue-800\">Total Fees</div>\n                  </div>\n                  <div className=\"bg-green-50 p-3 rounded-lg\">\n                    <div className=\"text-2xl font-bold text-green-600\">${reportData.totalAmount.toFixed(2)}</div>\n                    <div className=\"text-sm text-green-800\">Total Amount</div>\n                  </div>\n                  <div className=\"bg-yellow-50 p-3 rounded-lg\">\n                    <div className=\"text-2xl font-bold text-yellow-600\">${reportData.totalPaid.toFixed(2)}</div>\n                    <div className=\"text-sm text-yellow-800\">Total Paid</div>\n                  </div>\n                  <div className=\"bg-red-50 p-3 rounded-lg\">\n                    <div className=\"text-2xl font-bold text-red-600\">${reportData.totalBalance.toFixed(2)}</div>\n                    <div className=\"text-sm text-red-800\">Total Balance</div>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-4 mb-4\">\n                  <div className=\"text-center\">\n                    <div className=\"text-lg font-semibold text-green-600\">{reportData.statusBreakdown.paid}</div>\n                    <div className=\"text-sm text-gray-600\">Paid</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-lg font-semibold text-red-600\">{reportData.statusBreakdown.unpaid}</div>\n                    <div className=\"text-sm text-gray-600\">Unpaid</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-lg font-semibold text-yellow-600\">{reportData.statusBreakdown.partial}</div>\n                    <div className=\"text-sm text-gray-600\">Partial</div>\n                  </div>\n                </div>\n\n                <div className=\"text-sm text-gray-600 mb-4\">\n                  <p><strong>Report Generated:</strong> {reportData.generatedAt}</p>\n                  <p><strong>Department:</strong> {reportData.department}</p>\n                  <p><strong>Semester:</strong> {reportData.semester}</p>\n                  {reportData.student && (\n                    <p><strong>Student:</strong> {capitalizeFirstLetter(formatStudentName(reportData.student))} ({reportData.student.registration_number})</p>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Student</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Semester</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Paid</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Balance</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Status</th>\n                      <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Due Date</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {reportData.fees.map((fee: Fee) => {\n                      const student = students.find(s => s.id === fee.student);\n                      return (\n                        <tr key={fee.fee_id}>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {student ? capitalizeFirstLetter(formatStudentName(student)) : 'Unknown'}\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {semesters.find(s => s.id === fee.semester)?.name || 'Unknown Semester'}\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">${fee.amount}</td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">${fee.paid_amount}</td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">${fee.balance.toFixed(2)}</td>\n                          <td className=\"px-4 py-4 whitespace-nowrap\">\n                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                              fee.status === 'Paid' ? 'bg-green-100 text-green-800' :\n                              fee.status === 'Unpaid' ? 'bg-red-100 text-red-800' :\n                              'bg-yellow-100 text-yellow-800'\n                            }`}>\n                              {fee.status}\n                            </span>\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">{fee.due_date}</td>\n                        </tr>\n                      );\n                    })}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showPaymentHistoryModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center\">\n                  <FontAwesomeIcon icon={faHistory} className=\"text-blue-600 text-xl mr-2\" />\n                  <h2 className=\"text-xl font-bold text-gray-800\">Payment History</h2>\n                </div>\n                <button\n                  onClick={() => setShowPaymentHistoryModal(false)}\n                  className=\"text-gray-500 hover:text-gray-700\"\n                >\n                  <FontAwesomeIcon icon={faCheckCircle} size=\"lg\" />\n                </button>\n              </div>\n\n              {paymentHistory.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <FontAwesomeIcon icon={faHistory} className=\"text-gray-400 text-4xl mb-4\" />\n                  <p className=\"text-gray-600\">No payment history found.</p>\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <table className=\"min-w-full divide-y divide-gray-200\">\n                    <thead className=\"bg-gray-50\">\n                      <tr>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Date</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Method</th>\n                        <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Notes</th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\n                      {paymentHistory.map((payment: any, index: number) => (\n                        <tr key={payment.payment_id || index} className=\"hover:bg-gray-50\">\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            {new Date(payment.payment_date).toLocaleDateString()}\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold text-green-600\">\n                            ${payment.amount}\n                          </td>\n                          <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\n                              payment.payment_method === 'Cash' ? 'bg-green-100 text-green-800' :\n                              payment.payment_method === 'Online' ? 'bg-blue-100 text-blue-800' :\n                              'bg-purple-100 text-purple-800'\n                            }`}>\n                              {payment.payment_method}\n                            </span>\n                          </td>\n                          <td className=\"px-4 py-4 text-sm text-gray-900\">\n                            {payment.notes || 'N/A'}\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              )}\n\n              <div className=\"mt-6 flex justify-end\">\n                <button\n                  onClick={() => setShowPaymentHistoryModal(false)}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\"\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showBulkPaymentModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center\">\n                  <FontAwesomeIcon icon={faCreditCard} className=\"text-green-600 text-xl mr-2\" />\n                  <h2 className=\"text-xl font-bold text-gray-800\">Bulk Payment Processing</h2>\n                </div>\n                <button\n                  onClick={() => setShowBulkPaymentModal(false)}\n                  className=\"text-gray-500 hover:text-gray-700\"\n                >\n                  <FontAwesomeIcon icon={faCheckCircle} size=\"lg\" />\n                </button>\n              </div>\n\n              <div className=\"mb-6\">\n                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">\n                  Selected Students ({selectedStudentsForPayment.length})\n                </h3>\n                <div className=\"bg-gray-50 rounded-lg p-4 max-h-60 overflow-y-auto\">\n                  {selectedStudentsForPayment.map(studentId => {\n                    const studentData = studentFeeStatuses.find(s => s.id === studentId);\n                    return studentData ? (\n                      <div key={studentId} className=\"flex items-center justify-between py-2 border-b border-gray-200 last:border-b-0\">\n                        <div>\n                          <span className=\"font-medium\">{formatStudentName(studentData)}</span>\n                          <span className=\"text-sm text-gray-600 ml-2\">\n                            (${studentData.fee_info?.balance?.toFixed(2) || '0.00'} remaining)\n                          </span>\n                        </div>\n                        <button\n                          onClick={() => {\n                            setSelectedStudentsForPayment(selectedStudentsForPayment.filter(id => id !== studentId));\n                          }}\n                          className=\"text-red-500 hover:text-red-700\"\n                        >\n                          <FontAwesomeIcon icon={faCheckCircle} />\n                        </button>\n                      </div>\n                    ) : null;\n                  })}\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-gray-700 text-sm font-bold mb-2\">Payment Method</label>\n                  <select\n                    value={paymentMethod}\n                    onChange={(e) => setPaymentMethod(e.target.value)}\n                    className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500\"\n                  >\n                    <option value=\"Cash\">Cash</option>\n                    <option value=\"Online\">Online</option>\n                    <option value=\"Cheque\">Cheque</option>\n                  </select>\n                </div>\n\n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <p className=\"text-sm text-blue-800\">\n                    <strong>Note:</strong> This will process full payment for all selected students.\n                    Each student will receive a separate receipt.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end space-x-3 mt-6\">\n                <button\n                  onClick={() => setShowBulkPaymentModal(false)}\n                  className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={async () => {\n                    setIsLoading(true);\n                    try {\n                      for (const studentId of selectedStudentsForPayment) {\n                        const studentData = studentFeeStatuses.find(s => s.id === studentId);\n                        if (studentData && studentData.fee_info) {\n                          const paymentData = {\n                            amount: studentData.fee_info.balance || 0,\n                            payment_method: paymentMethod,\n                            notes: `Bulk payment for ${semesters.find(s => s.id === selectedSemester)?.name || 'Unknown Semester'}`\n                          };\n\n                          await api.post(`academics/fees/${studentData.fee_info.fee_id}/payments/`, paymentData);\n                        }\n                      }\n\n                      // Refresh data\n                      await fetchStudentFeeStatuses();\n                      setSelectedStudentsForPayment([]);\n                      setShowBulkPaymentModal(false);\n\n                      alert(`Successfully processed payments for ${selectedStudentsForPayment.length} students!`);\n                    } catch (err: any) {\n                      setError(err.message || 'Failed to process bulk payments');\n                    } finally {\n                      setIsLoading(false);\n                    }\n                  }}\n                  disabled={isLoading || selectedStudentsForPayment.length === 0}\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-colors duration-200\"\n                >\n                  {isLoading ? <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div> : <FontAwesomeIcon icon={faCreditCard} className=\"mr-2\" />}\n                  {isLoading ? 'Processing...' : `Process Payments (${selectedStudentsForPayment.length})`}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showGenerateReceiptModal && receiptData && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-auto max-h-[90vh] overflow-y-auto\">\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center\">\n                  <FontAwesomeIcon icon={faFileAlt} className=\"text-blue-600 text-xl mr-2\" />\n                  <h2 className=\"text-xl font-bold text-gray-800\">Fee Receipt</h2>\n                </div>\n                <div className=\"flex space-x-2\">\n                  <button\n                    onClick={() => window.print()}\n                    className=\"inline-flex items-center px-3 py-1 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n                  >\n                    <FontAwesomeIcon icon={faFileAlt} className=\"mr-2\" />\n                    Print\n                  </button>\n                  <button\n                    onClick={() => setShowGenerateReceiptModal(false)}\n                    className=\"text-gray-500 hover:text-gray-700\"\n                  >\n                    <FontAwesomeIcon icon={faCheckCircle} size=\"lg\" />\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"border-t border-b border-gray-200 py-4 mb-4\">\n                <div className=\"text-center mb-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-800\">University Fee Payment</h3>\n                  <p className=\"text-sm text-gray-600\">Receipt #{receiptData.fee?.fee_id || Date.now()}</p>\n                </div>\n\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Student:</span>\n                    <span>{formatStudentName(receiptData.student)}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Registration:</span>\n                    <span>{receiptData.student.registration_number || 'N/A'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Semester:</span>\n                    <span>{receiptData.semester}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Fee Amount:</span>\n                    <span>${receiptData.fee?.amount || '0.00'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Total Paid:</span>\n                    <span className=\"font-semibold text-green-600\">${receiptData.totalPaid?.toFixed(2) || '0.00'}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"font-medium\">Balance:</span>\n                    <span>${receiptData.balance?.toFixed(2) || '0.00'}</span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mb-4\">\n                <h5 className=\"text-md font-medium text-gray-800 mb-2\">Payment History</h5>\n                {receiptData.payments && receiptData.payments.length > 0 ? (\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full divide-y divide-gray-200\">\n                      <thead className=\"bg-gray-50\">\n                        <tr>\n                          <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Submission Date</th>\n                          <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Amount</th>\n                          <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Method</th>\n                          <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Notes</th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {receiptData.payments.map((payment: any, index: number) => (\n                          <tr key={payment.payment_id || index} className=\"hover:bg-gray-50\">\n                            <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900\">\n                              {new Date(payment.payment_date).toLocaleDateString()}\n                            </td>\n                            <td className=\"px-3 py-2 whitespace-nowrap text-sm font-medium text-green-600\">\n                              ${payment.amount}\n                            </td>\n                            <td className=\"px-3 py-2 whitespace-nowrap text-sm text-gray-900\">\n                              {payment.payment_method}\n                            </td>\n                            <td className=\"px-3 py-2 text-sm text-gray-900\">\n                              {payment.notes || 'N/A'}\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                ) : (\n                  <p className=\"text-sm text-gray-600\">No payment history available.</p>\n                )}\n              </div>\n\n              <div className=\"text-center\">\n                <p className=\"text-xs text-gray-500 mb-4\">\n                  Thank you for your payment. This receipt serves as proof of payment.\n                </p>\n                <p className=\"text-xs text-gray-500\">\n                  Generated on {receiptData.generatedAt}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FeeManagement;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}