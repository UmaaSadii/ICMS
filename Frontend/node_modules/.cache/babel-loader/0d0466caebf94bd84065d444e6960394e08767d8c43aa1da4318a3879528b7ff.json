{"ast":null,"code":"import axios from\"axios\";export const api=axios.create({baseURL:process.env.REACT_APP_API_BASE_URL||\"http://127.0.0.1:8000/api/\"// your Django DRF base URL\n// Removed default Content-Type to allow automatic setting for FormData\n});// Add a request interceptor to include auth token\napi.interceptors.request.use(function(config){// Get the token from localStorage\nconst storedAuth=localStorage.getItem('auth');if(storedAuth){try{const authData=JSON.parse(storedAuth);if(authData.access_token){config.headers.Authorization=\"Token \".concat(authData.access_token);// Ensure the header is properly set\nconsole.log('Setting auth header:',\"Token \".concat(authData.access_token));}else{console.warn('No access token found in auth data');}}catch(err){console.error('Error parsing stored auth data:',err);localStorage.removeItem('auth');// Remove invalid auth data\n}}else{console.warn('No auth data found in localStorage');}return config;});// Add a response interceptor to handle auth errors\napi.interceptors.response.use(response=>response,error=>{if(error.response){if(error.response.status===401){console.error('Unauthorized request:',error.config.url);// Show a more user-friendly message\nerror.message='Please login to access this feature';}else if(error.response.status===403){console.error('Forbidden request:',error.config.url);error.message='You do not have permission to perform this action';}else if(error.response.status===400){console.error('Bad request:',error.config.url,error.response.data);// Extract error message from response if available\nif(error.response.data&&typeof error.response.data==='object'){const firstErrorKey=Object.keys(error.response.data)[0];if(firstErrorKey){error.message=\"\".concat(firstErrorKey,\": \").concat(error.response.data[firstErrorKey]);}}}}return Promise.reject(error);});export const authService={login:data=>api.post(\"login/\",data),register:data=>api.post(\"register/\",data),logout:()=>{localStorage.removeItem('auth');delete api.defaults.headers.common['Authorization'];}};","map":{"version":3,"names":["axios","api","create","baseURL","process","env","REACT_APP_API_BASE_URL","interceptors","request","use","config","storedAuth","localStorage","getItem","authData","JSON","parse","access_token","headers","Authorization","concat","console","log","warn","err","error","removeItem","response","status","url","message","data","firstErrorKey","Object","keys","Promise","reject","authService","login","post","register","logout","defaults","common"],"sources":["c:/UMI/Frontend/src/api/api.ts"],"sourcesContent":["import axios from \"axios\";\n\nexport const api = axios.create({\n  baseURL: process.env.REACT_APP_API_BASE_URL || \"http://127.0.0.1:8000/api/\", // your Django DRF base URL\n  // Removed default Content-Type to allow automatic setting for FormData\n});\n\n// Add a request interceptor to include auth token\napi.interceptors.request.use(function (config) {\n  // Get the token from localStorage\n  const storedAuth = localStorage.getItem('auth');\n  if (storedAuth) {\n    try {\n      const authData = JSON.parse(storedAuth);\n      if (authData.access_token) {\n        config.headers.Authorization = `Token ${authData.access_token}`;\n        // Ensure the header is properly set\n        console.log('Setting auth header:', `Token ${authData.access_token}`);\n      } else {\n        console.warn('No access token found in auth data');\n      }\n    } catch (err) {\n      console.error('Error parsing stored auth data:', err);\n      localStorage.removeItem('auth'); // Remove invalid auth data\n    }\n  } else {\n    console.warn('No auth data found in localStorage');\n  }\n  return config;\n});\n\n// Add a response interceptor to handle auth errors\napi.interceptors.response.use(\n  response => response,\n  error => {\n    if (error.response) {\n      if (error.response.status === 401) {\n        console.error('Unauthorized request:', error.config.url);\n        // Show a more user-friendly message\n        error.message = 'Please login to access this feature';\n      } else if (error.response.status === 403) {\n        console.error('Forbidden request:', error.config.url);\n        error.message = 'You do not have permission to perform this action';\n      } else if (error.response.status === 400) {\n        console.error('Bad request:', error.config.url, error.response.data);\n        // Extract error message from response if available\n        if (error.response.data && typeof error.response.data === 'object') {\n          const firstErrorKey = Object.keys(error.response.data)[0];\n          if (firstErrorKey) {\n            error.message = `${firstErrorKey}: ${error.response.data[firstErrorKey]}`;\n          }\n        }\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport const authService = {\n  login: (data: { username: string; password: string }) =>\n    api.post(\"login/\", data),\n  register: (data: any) => api.post(\"register/\", data),\n  logout: () => {\n    localStorage.removeItem('auth');\n    delete api.defaults.headers.common['Authorization'];\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}